function PhotoSphereViewer(t){if(!(this instanceof PhotoSphereViewer))return new PhotoSphereViewer(t);if(PhotoSphereViewer.SYSTEM.loaded||PhotoSphereViewer._loadSystem(),this.config=PSVUtils.clone(PhotoSphereViewer.DEFAULTS),PSVUtils.deepmerge(this.config,t),!t.container)throw new PSVError("No value given for container.");if(!PhotoSphereViewer.SYSTEM.isCanvasSupported)throw new PSVError("Canvas is not supported.");if(!(PhotoSphereViewer.SYSTEM.isWebGLSupported&&this.config.webgl||PSVUtils.checkTHREE("CanvasRenderer","Projector")))throw new PSVError("Missing Three.js components: CanvasRenderer, Projector. Get them from three.js-examples package.");if(this.config.longitude_range&&2!==this.config.longitude_range.length&&(this.config.longitude_range=null,console.warn("PhotoSphereViewer: longitude_range must have exactly two elements.")),this.config.latitude_range?2!==this.config.latitude_range.length?(this.config.latitude_range=null,console.warn("PhotoSphereViewer: latitude_range must have exactly two elements.")):this.config.latitude_range[0]>this.config.latitude_range[1]&&(this.config.latitude_range=[this.config.latitude_range[1],this.config.latitude_range[0]],console.warn("PhotoSphereViewer: latitude_range values must be ordered.")):void 0===this.config.tilt_up_max&&void 0===this.config.tilt_down_max||(this.config.latitude_range=[void 0!==this.config.tilt_down_max?this.config.tilt_down_max-Math.PI/4:-PSVUtils.HalfPI,void 0!==this.config.tilt_up_max?this.config.tilt_up_max+Math.PI/4:PSVUtils.HalfPI],console.warn("PhotoSphereViewer: tilt_up_max and tilt_down_max are deprecated, use latitude_range instead.")),this.config.max_fov<this.config.min_fov){var e=this.config.max_fov;this.config.max_fov=this.config.min_fov,this.config.min_fov=e,console.warn("PhotoSphereViewer: max_fov cannot be lower than min_fov.")}this.config.cache_texture&&(!PSVUtils.isInteger(this.config.cache_texture)||this.config.cache_texture<0)&&(this.config.cache_texture=PhotoSphereViewer.DEFAULTS.cache_texture,console.warn("PhotoSphreViewer: invalid valud for cache_texture")),this.config.min_fov=PSVUtils.bound(this.config.min_fov,1,179),this.config.max_fov=PSVUtils.bound(this.config.max_fov,1,179),null===this.config.default_fov?this.config.default_fov=this.config.max_fov/2+this.config.min_fov/2:this.config.default_fov=PSVUtils.bound(this.config.default_fov,this.config.min_fov,this.config.max_fov),this.config.default_long=PSVUtils.parseAngle(this.config.default_long),this.config.default_lat=PSVUtils.parseAngle(this.config.default_lat,-Math.PI),this.config.default_lat=PSVUtils.bound(this.config.default_lat,-PSVUtils.HalfPI,PSVUtils.HalfPI),null===this.config.anim_lat?this.config.anim_lat=this.config.default_lat:(this.config.anim_lat=PSVUtils.parseAngle(this.config.anim_lat,-Math.PI),this.config.anim_lat=PSVUtils.bound(this.config.anim_lat,-PSVUtils.HalfPI,PSVUtils.HalfPI)),this.config.longitude_range&&(this.config.longitude_range=this.config.longitude_range.map(function(t){return PSVUtils.parseAngle(t)})),this.config.latitude_range&&(this.config.latitude_range=this.config.latitude_range.map(function(t){return t=PSVUtils.parseAngle(t,-Math.PI),PSVUtils.bound(t,-PSVUtils.HalfPI,PSVUtils.HalfPI)})),this.config.anim_speed=PSVUtils.parseSpeed(this.config.anim_speed),this.config.caption&&!this.config.navbar&&(this.config.navbar=["caption"]),!0===this.config.fisheye?this.config.fisheye=1:!1===this.config.fisheye&&(this.config.fisheye=0),this.parent="string"==typeof t.container?document.getElementById(t.container):t.container,this.container=null,this.loader=null,this.navbar=null,this.hud=null,this.panel=null,this.tooltip=null,this.canvas_container=null,this.renderer=null,this.scene=null,this.camera=null,this.mesh=null,this.raycaster=null,this.doControls=null,this.prop={isCubemap:void 0,longitude:0,latitude:0,direction:null,anim_speed:0,zoom_lvl:0,vFov:0,hFov:0,aspect:0,move_speed:.1,moving:!1,zooming:!1,start_mouse_x:0,start_mouse_y:0,mouse_x:0,mouse_y:0,mouse_history:[],pinch_dist:0,orientation_reqid:null,autorotate_reqid:null,animation_promise:null,loading_promise:null,start_timeout:null,dblclick_data:null,dblclick_timeout:null,cache:[],size:{width:0,height:0},pano_data:{full_width:0,full_height:0,cropped_width:0,cropped_height:0,cropped_x:0,cropped_y:0}},Object.keys(PhotoSphereViewer.TEMPLATES).forEach(function(t){this.config.templates[t]||(this.config.templates[t]=PhotoSphereViewer.TEMPLATES[t]),"string"==typeof this.config.templates[t]&&(this.config.templates[t]=doT.template(this.config.templates[t]))},this),this.parent.photoSphereViewer=this,this.container=document.createElement("div"),this.container.classList.add("psv-container"),this.parent.appendChild(this.container),null!==this.config.size&&this._setViewerSize(this.config.size),this._onResize();var o=Math.round((this.config.default_fov-this.config.min_fov)/(this.config.max_fov-this.config.min_fov)*100);this.zoom(o-2*(o-50),!1),this.prop.move_speed=THREE.Math.degToRad(this.config.move_speed/PhotoSphereViewer.SYSTEM.pixelRatio),this.rotate({longitude:this.config.default_long,latitude:this.config.default_lat},!1),this.loader=new PSVLoader(this),this.loader.hide(),this.navbar=new PSVNavBar(this),this.navbar.hide(),this.hud=new PSVHUD(this),this.hud.hide(),this.panel=new PSVPanel(this),this.tooltip=new PSVTooltip(this.hud),this._bindEvents(),this.config.autoload&&this.load(),this.once("render",function(){this.config.navbar&&(this.container.classList.add("psv-container--has-navbar"),this.navbar.show()),this.hud.show(),this.config.markers&&(this.config.markers.forEach(function(t){this.hud.addMarker(t,!1)},this),this.hud.renderMarkers()),!1!==this.config.time_anim&&(this.prop.start_timeout=window.setTimeout(this.startAutorotate.bind(this),this.config.time_anim)),this.trigger("ready")}.bind(this))}function PSVComponent(t){this.psv=t instanceof PhotoSphereViewer?t:t.psv,this.parent=t,this.container=null,this.constructor.publicMethods&&this.constructor.publicMethods.forEach(function(t){this.psv[t]=this[t].bind(this)},this)}function PSVHUD(t){PSVComponent.call(this,t),this.svgContainer=null,this.markers={},this.currentMarker=null,this.hoveringMarker=null,this.prop={panelOpened:!1,panelOpening:!1,markersButton:this.psv.navbar.getNavbarButton("markers")},this.create()}function PSVLoader(t){PSVComponent.call(this,t),this.canvas=null,this.loader=null,this.create()}function PSVNavBar(t){if(PSVComponent.call(this,t),this.config=this.psv.config.navbar,this.items=[],!0===this.config)this.config=PSVUtils.clone(PhotoSphereViewer.DEFAULTS.navbar);else if("string"==typeof this.config)this.config=this.config.split(" ");else if(!Array.isArray(this.config)){console.warn('PhotoSphereViewer: hashmap form of "navbar" is deprecated, use an array instead.');var e=this.config;this.config=[];for(var o in e)e[o]&&this.config.push(o);this.config.sort(function(t,e){return PhotoSphereViewer.DEFAULTS.navbar.indexOf(t)-PhotoSphereViewer.DEFAULTS.navbar.indexOf(e)})}this.create()}function PSVNavBarCaption(t,e){PSVComponent.call(this,t),this.create(),this.setCaption(e)}function PSVNavBarSpacer(t,e){PSVComponent.call(this,t),this.weight=e||5,this.create(),this.container.classList.add("psv-spacer--weight-"+this.weight)}function PSVPanel(t){PSVComponent.call(this,t),this.content=null,this.prop={mouse_x:0,mouse_y:0,mousedown:!1,opened:!1},this.create()}function PSVTooltip(t){PSVComponent.call(this,t),this.config=this.psv.config.tooltip,this.prop={timeout:null},this.create()}function PSVNavBarButton(t){PSVComponent.call(this,t),this.id=void 0,this.constructor.id&&(this.id=this.constructor.id),this.enabled=!0}function PSVNavBarAutorotateButton(t){PSVNavBarButton.call(this,t),this.create()}function PSVNavBarCustomButton(t,e){PSVNavBarButton.call(this,t),this.config=e,this.config.id&&(this.id=this.config.id),this.create()}function PSVNavBarDownloadButton(t){PSVNavBarButton.call(this,t),this.create()}function PSVNavBarFullscreenButton(t){PSVNavBarButton.call(this,t),this.create()}function PSVNavBarGyroscopeButton(t){PSVNavBarButton.call(this,t),this.create()}function PSVNavBarMarkersButton(t){PSVNavBarButton.call(this,t),this.create()}function PSVNavBarZoomButton(t){PSVNavBarButton.call(this,t),this.zoom_range=null,this.zoom_value=null,this.prop={mousedown:!1,buttondown:!1,longPressInterval:null},this.create()}function PSVError(t){this.message=t,"captureStackTrace"in Error?Error.captureStackTrace(this,PSVError):this.stack=(new Error).stack}function PSVMarker(t,e){if(!t.id)throw new PSVError("missing marker id");if(t.image&&(!t.width||!t.height))throw new PSVError("missing marker width/height");if((t.image||t.html)&&!(t.hasOwnProperty("x")&&t.hasOwnProperty("y")||t.hasOwnProperty("latitude")&&t.hasOwnProperty("longitude")))throw new PSVError("missing marker position, latitude/longitude or x/y");this.psv=e,this.visible=!0,this._dynamicSize=!1;var o,i=t.id,r=PSVMarker.getType(t,!1);Object.defineProperties(this,{id:{configurable:!1,enumerable:!0,get:function(){return i},set:function(t){}},type:{configurable:!1,enumerable:!0,get:function(){return r},set:function(t){}},$el:{configurable:!1,enumerable:!0,get:function(){return o},set:function(t){}},_def:{configurable:!1,enumerable:!0,get:function(){return this[r]},set:function(t){this[r]=t}}}),(o=this.isNormal()?document.createElement("div"):this.isPolygon()?document.createElementNS(PSVUtils.svgNS,"polygon"):document.createElementNS(PSVUtils.svgNS,this.type)).id="psv-marker-"+this.id,o.psvMarker=this,this.update(t)}uEvent.mixin(PhotoSphereViewer),PhotoSphereViewer.prototype._loadXMP=function(t){if(!this.config.usexmpdata)return D.resolved(null);var e=D(),o=new XMLHttpRequest,i=this,r=0;return o.onreadystatechange=function(){if(4===o.readyState){if(200!==o.status&&201!==o.status&&202!==o.status&&0!==o.status)throw i.container.textContent="Cannot load image",new PSVError("Cannot load image");i.loader.setProgress(100);var t=o.responseText,n=t.indexOf("<x:xmpmeta"),s=t.indexOf("</x:xmpmeta>"),a=t.substring(n,s);if(-1===n||-1===s||-1===a.indexOf("GPano:"))e.resolve(null);else{var h={full_width:parseInt(PSVUtils.getXMPValue(a,"FullPanoWidthPixels")),full_height:parseInt(PSVUtils.getXMPValue(a,"FullPanoHeightPixels")),cropped_width:parseInt(PSVUtils.getXMPValue(a,"CroppedAreaImageWidthPixels")),cropped_height:parseInt(PSVUtils.getXMPValue(a,"CroppedAreaImageHeightPixels")),cropped_x:parseInt(PSVUtils.getXMPValue(a,"CroppedAreaLeftPixels")),cropped_y:parseInt(PSVUtils.getXMPValue(a,"CroppedAreaTopPixels"))};h.full_width&&h.full_height&&h.cropped_width&&h.cropped_height?e.resolve(h):(console.warn("PhotoSphereViewer: invalid XMP data"),e.resolve(null))}}else 3===o.readyState&&i.loader.setProgress(r+=10)},o.onprogress=function(t){if(t.lengthComputable){var e=parseInt(t.loaded/t.total*100);e>r&&(r=e,i.loader.setProgress(r))}},o.onerror=function(){throw i.container.textContent="Cannot load image",new PSVError("Cannot load image")},o.open("GET",t,!0),o.send(null),e.promise},PhotoSphereViewer.prototype._loadTexture=function(t){var e=[];if(Array.isArray(t)){if(6!==t.length)throw new PSVError("Must provide exactly 6 image paths when using cubemap.");for(var o=0;o<6;o++)e[o]=t[PhotoSphereViewer.CUBE_MAP[o]];t=e}else if("object"==typeof t){if(!PhotoSphereViewer.CUBE_HASHMAP.every(function(e){return!!t[e]}))throw new PSVError("Must provide exactly left, front, right, back, top, bottom when using cubemap.");PhotoSphereViewer.CUBE_HASHMAP.forEach(function(o,i){e[i]=t[o]}),t=e}if(Array.isArray(t)){if(!1===this.prop.isCubemap)throw new PSVError("The viewer was initialized with an equirectangular panorama, cannot switch to cubemap.");return this.config.fisheye&&console.warn("PhotoSphereViewer: fisheye effect with cubemap texture can generate distorsions."),this.config.cache_texture===PhotoSphereViewer.DEFAULTS.cache_texture&&(this.config.cache_texture*=6),this.prop.isCubemap=!0,this._loadCubemapTexture(t)}if(!0===this.prop.isCubemap)throw new PSVError("The viewer was initialized with an cubemap, cannot switch to equirectangular panorama.");return this.prop.isCubemap=!1,this._loadEquirectangularTexture(t)},PhotoSphereViewer.prototype._loadEquirectangularTexture=function(t){if(this.config.cache_texture){var e=this.getPanoramaCache(t);if(e)return this.prop.pano_data=e.pano_data,D.resolved(e.image)}return this._loadXMP(t).then(function(e){var o=D(),i=new THREE.ImageLoader,r=e?100:0;i.setCrossOrigin("anonymous");return i.load(t,function(i){r=100,this.loader.setProgress(r),this.trigger("panorama-load-progress",t,r),!e&&this.config.pano_data&&(e=PSVUtils.clone(this.config.pano_data)),e||(e={full_width:i.width,full_height:i.height,cropped_width:i.width,cropped_height:i.height,cropped_x:0,cropped_y:0}),this.prop.pano_data=e;var n,s=Math.min(e.full_width,PhotoSphereViewer.SYSTEM.maxTextureWidth)/e.full_width;if(1!==s||e.cropped_width!=e.full_width||e.cropped_height!=e.full_height){var a=PSVUtils.clone(e);a.full_width*=s,a.full_height*=s,a.cropped_width*=s,a.cropped_height*=s,a.cropped_x*=s,a.cropped_y*=s,i.width=a.cropped_width,i.height=a.cropped_height;var h=document.createElement("canvas");h.width=a.full_width,h.height=a.full_height,h.getContext("2d").drawImage(i,a.cropped_x,a.cropped_y,a.cropped_width,a.cropped_height),n=new THREE.Texture(h)}else n=new THREE.Texture(i);n.needsUpdate=!0,n.minFilter=THREE.LinearFilter,n.generateMipmaps=!1,this.config.cache_texture&&this._putPanoramaCache({panorama:t,image:n,pano_data:e}),o.resolve(n)}.bind(this),function(e){if(e.lengthComputable){var o=parseInt(e.loaded/e.total*100);o>r&&(r=o,this.loader.setProgress(r),this.trigger("panorama-load-progress",t,r))}}.bind(this),function(t){throw this.container.textContent="Cannot load image",o.reject(t),new PSVError("Cannot load image")}.bind(this)),o.promise}.bind(this))},PhotoSphereViewer.prototype._loadCubemapTexture=function(t){var e=D(),o=new THREE.ImageLoader,i=[0,0,0,0,0,0],r=[],n=0;o.setCrossOrigin("anonymous");for(var s=function(){r.forEach(function(t){t.needsUpdate=!0,t.minFilter=THREE.LinearFilter,t.generateMipmaps=!1}),e.resolve(r)},a=0;a<6;a++){if(this.config.cache_texture){var h=this.getPanoramaCache(t[a]);if(h){n++,i[a]=100,r[a]=h.image;continue}}o.load(t[a],function(e,o){n++,i[e]=100,this.loader.setProgress(PSVUtils.sum(i)/6),this.trigger("panorama-load-progress",t[e],i[e]);var a=Math.min(o.width,PhotoSphereViewer.SYSTEM.maxTextureWidth/2)/o.width;if(1!==a){var h=document.createElement("canvas");h.width=o.width*a,h.height=o.height*a,h.getContext("2d").drawImage(o,0,0,h.width,h.height),r[e]=new THREE.Texture(h)}else r[e]=new THREE.Texture(o);this.config.cache_texture&&this._putPanoramaCache({panorama:t[e],image:r[e]}),6===n&&s()}.bind(this,a),function(e,o){if(o.lengthComputable){var r=parseInt(o.loaded/o.total*100);r>i[e]&&(i[e]=r,this.loader.setProgress(PSVUtils.sum(i)/6),this.trigger("panorama-load-progress",t[e],i[e]))}}.bind(this,a),function(t,o){throw this.container.textContent="Cannot load image",e.reject(o),new PSVError("Cannot load image "+t)}.bind(this,a))}return 6===n&&e.resolve(r),e.promise},PhotoSphereViewer.prototype._setTexture=function(t){if(this.scene||this._createScene(),this.prop.isCubemap)for(var e=0;e<6;e++)this.mesh.material.materials[e].map&&this.mesh.material.materials[e].map.dispose(),this.mesh.material.materials[e].map=t[e];else this.mesh.material.map&&this.mesh.material.map.dispose(),this.mesh.material.map=t;this.trigger("panorama-loaded"),this.render()},PhotoSphereViewer.prototype._createScene=function(){this.raycaster=new THREE.Raycaster,this.renderer=PhotoSphereViewer.SYSTEM.isWebGLSupported&&this.config.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer,this.renderer.setSize(this.prop.size.width,this.prop.size.height),this.renderer.setPixelRatio(PhotoSphereViewer.SYSTEM.pixelRatio);var t=PhotoSphereViewer.SPHERE_RADIUS;this.prop.isCubemap&&(t*=Math.sqrt(3)),this.config.fisheye&&(t+=PhotoSphereViewer.SPHERE_RADIUS),this.camera=new THREE.PerspectiveCamera(this.config.default_fov,this.prop.size.width/this.prop.size.height,1,t),this.camera.position.set(0,0,0),this.config.gyroscope&&PSVUtils.checkTHREE("DeviceOrientationControls")&&(this.doControls=new THREE.DeviceOrientationControls(this.camera)),this.scene=new THREE.Scene,this.scene.add(this.camera),this.prop.isCubemap?this._createCubemap():this._createSphere(),this.canvas_container=document.createElement("div"),this.canvas_container.className="psv-canvas-container",this.renderer.domElement.className="psv-canvas",this.container.appendChild(this.canvas_container),this.canvas_container.appendChild(this.renderer.domElement)},PhotoSphereViewer.prototype._createSphere=function(){var t=new THREE.SphereGeometry(PhotoSphereViewer.SPHERE_RADIUS,PhotoSphereViewer.SPHERE_VERTICES,PhotoSphereViewer.SPHERE_VERTICES,-PSVUtils.HalfPI),e=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,overdraw:PhotoSphereViewer.SYSTEM.isWebGLSupported&&this.config.webgl?0:1});this.mesh=new THREE.Mesh(t,e),this.mesh.scale.x=-1,this.scene.add(this.mesh)},PhotoSphereViewer.prototype._createCubemap=function(){for(var t=new THREE.BoxGeometry(2*PhotoSphereViewer.SPHERE_RADIUS,2*PhotoSphereViewer.SPHERE_RADIUS,2*PhotoSphereViewer.SPHERE_RADIUS,PhotoSphereViewer.CUBE_VERTICES,PhotoSphereViewer.CUBE_VERTICES,PhotoSphereViewer.CUBE_VERTICES),e=[],o=0;o<6;o++)e.push(new THREE.MeshBasicMaterial({overdraw:PhotoSphereViewer.SYSTEM.isWebGLSupported&&this.config.webgl?0:1}));this.mesh=new THREE.Mesh(t,new THREE.MultiMaterial(e)),this.mesh.position.x-=PhotoSphereViewer.SPHERE_RADIUS,this.mesh.position.y-=PhotoSphereViewer.SPHERE_RADIUS,this.mesh.position.z-=PhotoSphereViewer.SPHERE_RADIUS,this.mesh.applyMatrix((new THREE.Matrix4).makeScale(1,1,-1)),this.scene.add(this.mesh);var i=new THREE.MeshBasicMaterial({side:THREE.BackSide,visible:!1}),r=new THREE.Mesh(t,i);this.scene.add(r)},PhotoSphereViewer.prototype._transition=function(t,e){if(this.prop.isCubemap)throw new PSVError("Transition is not available with cubemap.");var o=this,i=new THREE.SphereGeometry(.9*PhotoSphereViewer.SPHERE_RADIUS,PhotoSphereViewer.SPHERE_VERTICES,PhotoSphereViewer.SPHERE_VERTICES,-PSVUtils.HalfPI),r=new THREE.MeshBasicMaterial({side:THREE.DoubleSide,overdraw:PhotoSphereViewer.SYSTEM.isWebGLSupported&&this.config.webgl?0:1,map:t,transparent:!0,opacity:0}),n=new THREE.Mesh(i,r);if(n.scale.x=-1,e){n.rotateY(e.longitude-this.prop.longitude);var s=new THREE.Vector3(0,1,0).cross(this.camera.getWorldDirection()).normalize(),a=(new THREE.Quaternion).setFromAxisAngle(s,e.latitude-this.prop.latitude);n.quaternion.multiplyQuaternions(a,n.quaternion)}return this.scene.add(n),this.render(),PSVUtils.animation({properties:{opacity:{start:0,end:1}},duration:o.config.transition.duration,easing:"outCubic",onTick:function(t){r.opacity=t.opacity,o.render()}}).then(function(){o.mesh.material.map.dispose(),o.mesh.material.map=t,o.scene.remove(n),n.geometry.dispose(),n.geometry=null,n.material.dispose(),n.material=null,e?((o.config.latitude_range||o.config.longitude_range)&&(o.config.longitude_range=o.config.latitude_range=null,console.warn("PhotoSphereViewer: trying to perform transition with longitude_range and/or latitude_range, ranges cleared.")),o.rotate(e)):o.render()})},PhotoSphereViewer.prototype._reverseAutorotate=function(){var t=this,e=-this.config.anim_speed,o=this.config.longitude_range;this.config.longitude_range=null,PSVUtils.animation({properties:{speed:{start:this.config.anim_speed,end:0}},duration:300,easing:"inSine",onTick:function(e){t.config.anim_speed=e.speed}}).then(function(){return PSVUtils.animation({properties:{speed:{start:0,end:e}},duration:300,easing:"outSine",onTick:function(e){t.config.anim_speed=e.speed}})}).then(function(){t.config.longitude_range=o,t.config.anim_speed=e})},PhotoSphereViewer.prototype._putPanoramaCache=function(t){if(!this.config.cache_texture)throw new PSVError("Cannot add panorama to cache, cache_texture is disabled");var e=this.getPanoramaCache(t.panorama);e?(e.image=t.image,e.pano_data=t.pano_data):(this.prop.cache=this.prop.cache.slice(0,this.config.cache_texture-1),this.prop.cache.unshift(t)),this.trigger("panorama-cached",t.panorama)},PhotoSphereViewer.prototype._stopAll=function(){this.stopAutorotate(),this.stopAnimation(),this.stopGyroscopeControl()},PhotoSphereViewer.MOVE_THRESHOLD=4,PhotoSphereViewer.DBLCLICK_DELAY=300,PhotoSphereViewer.INERTIA_WINDOW=300,PhotoSphereViewer.SPHERE_RADIUS=100,PhotoSphereViewer.SPHERE_VERTICES=64,PhotoSphereViewer.CUBE_VERTICES=8,PhotoSphereViewer.CUBE_MAP=[0,2,4,5,3,1],PhotoSphereViewer.CUBE_HASHMAP=["left","right","top","bottom","back","front"],PhotoSphereViewer.KEYMAP={33:"PageUp",34:"PageDown",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",107:"+",109:"-"},PhotoSphereViewer.SYSTEM={loaded:!1,pixelRatio:1,isWebGLSupported:!1,isCanvasSupported:!1,deviceOrientationSupported:null,maxTextureWidth:0,mouseWheelEvent:null,fullscreenEvent:null},PhotoSphereViewer.ICONS={},PhotoSphereViewer.DEFAULTS={panorama:null,container:null,caption:null,autoload:!0,usexmpdata:!0,pano_data:null,webgl:!0,min_fov:30,max_fov:90,default_fov:null,default_long:0,default_lat:0,longitude_range:null,latitude_range:null,move_speed:1,time_anim:2e3,anim_speed:"2rpm",anim_lat:null,fisheye:!1,navbar:["autorotate","zoom","download","markers","caption","gyroscope","fullscreen"],tooltip:{offset:5,arrow_size:7,delay:100},lang:{autorotate:"Automatic rotation",zoom:"Zoom",zoomOut:"Zoom out",zoomIn:"Zoom in",download:"Download",fullscreen:"Fullscreen",markers:"Markers",gyroscope:"Gyroscope"},mousewheel:!0,mousemove:!0,keyboard:!0,gyroscope:!1,move_inertia:!0,click_event_on_marker:!1,transition:{duration:1500,loader:!0},loading_img:null,loading_txt:"Loading...",size:null,cache_texture:5,templates:{},markers:[]},PhotoSphereViewer.TEMPLATES={markersList:'<div class="psv-markers-list-container">   <h1 class="psv-markers-list-title">{{= it.config.lang.markers }}</h1>   <ul class="psv-markers-list">   {{~ it.markers: marker }}     <li data-psv-marker="{{= marker.id }}" class="psv-markers-list-item {{? marker.className }}{{= marker.className }}{{?}}">       {{? marker.image }}<img class="psv-markers-list-image" src="{{= marker.image }}"/>{{?}}       <p class="psv-markers-list-name">{{? marker.tooltip }}{{= marker.tooltip.content }}{{?? marker.html }}{{= marker.html }}{{??}}{{= marker.id }}{{?}}</p>     </li>   {{~}}   </ul> </div>'},PhotoSphereViewer.prototype._bindEvents=function(){window.addEventListener("resize",this),this.config.mousemove&&(this.hud.container.style.cursor="move",this.hud.container.addEventListener("mousedown",this),this.hud.container.addEventListener("touchstart",this),window.addEventListener("mouseup",this),window.addEventListener("touchend",this),this.hud.container.addEventListener("mousemove",this),this.hud.container.addEventListener("touchmove",this)),PhotoSphereViewer.SYSTEM.fullscreenEvent&&document.addEventListener(PhotoSphereViewer.SYSTEM.fullscreenEvent,this),this.config.mousewheel&&this.hud.container.addEventListener(PhotoSphereViewer.SYSTEM.mouseWheelEvent,this),this.on("_side-reached",function(t){this.isAutorotateEnabled()&&("left"!==t&&"right"!==t||this._reverseAutorotate())})},PhotoSphereViewer.prototype.handleEvent=function(t){switch(t.type){case"resize":PSVUtils.throttle(this._onResize(),50);break;case"keydown":this._onKeyDown(t);break;case"mousedown":this._onMouseDown(t);break;case"touchstart":this._onTouchStart(t);break;case"mouseup":this._onMouseUp(t);break;case"touchend":this._onTouchEnd(t);break;case"mousemove":this._onMouseMove(t);break;case"touchmove":this._onTouchMove(t);break;case PhotoSphereViewer.SYSTEM.fullscreenEvent:this._fullscreenToggled();break;case PhotoSphereViewer.SYSTEM.mouseWheelEvent:this._onMouseWheel(t)}},PhotoSphereViewer.prototype._onResize=function(){this.container.clientWidth==this.prop.size.width&&this.container.clientHeight==this.prop.size.height||(this.prop.size.width=parseInt(this.container.clientWidth),this.prop.size.height=parseInt(this.container.clientHeight),this.prop.aspect=this.prop.size.width/this.prop.size.height,this.renderer&&(this.renderer.setSize(this.prop.size.width,this.prop.size.height),this.composer&&this.composer.reset(new THREE.WebGLRenderTarget(this.prop.size.width,this.prop.size.height)),this.render()),this.trigger("size-updated",this.getSize()))},PhotoSphereViewer.prototype._onKeyDown=function(t){var e=0,o=0,i=0;switch(t.key||PhotoSphereViewer.KEYMAP[t.keyCode||t.which]){case"ArrowUp":o=.01;break;case"ArrowDown":o=-.01;break;case"ArrowRight":e=.01;break;case"ArrowLeft":e=-.01;break;case"PageUp":case"+":i=1;break;case"PageDown":case"-":i=-1}0!==i?this.zoom(this.prop.zoom_lvl+i):0===o&&0===e||this.rotate({longitude:this.prop.longitude+e*this.prop.move_speed*this.prop.hFov,latitude:this.prop.latitude+o*this.prop.move_speed*this.prop.vFov})},PhotoSphereViewer.prototype._onMouseDown=function(t){this._startMove(t)},PhotoSphereViewer.prototype._onMouseUp=function(t){this._stopMove(t)},PhotoSphereViewer.prototype._onMouseMove=function(t){0!==t.buttons&&(t.preventDefault(),this._move(t))},PhotoSphereViewer.prototype._onTouchStart=function(t){1===t.touches.length?this._startMove(t.touches[0]):2===t.touches.length&&this._startZoom(t)},PhotoSphereViewer.prototype._onTouchEnd=function(t){this._stopMove(t.changedTouches[0])},PhotoSphereViewer.prototype._onTouchMove=function(t){1===t.touches.length?(t.preventDefault(),this._move(t.touches[0])):2===t.touches.length&&(t.preventDefault(),this._zoom(t))},PhotoSphereViewer.prototype._startMove=function(t){this.isGyroscopeEnabled()||(this._stopAll(),this.prop.mouse_x=this.prop.start_mouse_x=parseInt(t.clientX),this.prop.mouse_y=this.prop.start_mouse_y=parseInt(t.clientY),this.prop.moving=!0,this.prop.zooming=!1,this.prop.mouse_history.length=0,this._logMouseMove(t))},PhotoSphereViewer.prototype._startZoom=function(t){var e=[{x:parseInt(t.touches[0].clientX),y:parseInt(t.touches[0].clientY)},{x:parseInt(t.touches[1].clientX),y:parseInt(t.touches[1].clientY)}];this.prop.pinch_dist=Math.sqrt(Math.pow(e[0].x-e[1].x,2)+Math.pow(e[0].y-e[1].y,2)),this.prop.moving=!1,this.prop.zooming=!0},PhotoSphereViewer.prototype._stopMove=function(t){this.isGyroscopeEnabled()?this._click(t):(this.prop.moving&&(Math.abs(t.clientX-this.prop.start_mouse_x)<PhotoSphereViewer.MOVE_THRESHOLD&&Math.abs(t.clientY-this.prop.start_mouse_y)<PhotoSphereViewer.MOVE_THRESHOLD?(this._click(t),this.prop.moving=!1):this.config.move_inertia?(this._logMouseMove(t),this._stopMoveInertia(t)):this.prop.moving=!1),this.prop.mouse_history.length=0,this.prop.zooming=!1)},PhotoSphereViewer.prototype._stopMoveInertia=function(t){var e=this,o={x:t.clientX-this.prop.mouse_history[0][1],y:t.clientY-this.prop.mouse_history[0][2]},i=Math.sqrt(o.x*o.x+o.y*o.y);this.prop.animation_promise=PSVUtils.animation({properties:{clientX:{start:t.clientX,end:t.clientX+o.x},clientY:{start:t.clientY,end:t.clientY+o.y}},duration:i*PhotoSphereViewer.INERTIA_WINDOW/100,easing:"outCirc",onTick:function(t){e._move(t,!1)}}).ensure(function(){e.prop.moving=!1})},PhotoSphereViewer.prototype._click=function(t){var e=this.container.getBoundingClientRect(),o={target:t.target,client_x:t.clientX,client_y:t.clientY,viewer_x:parseInt(t.clientX-e.left),viewer_y:parseInt(t.clientY-e.top)},i=this.viewerCoordsToVector3({x:o.viewer_x,y:o.viewer_y});if(i){var r=this.vector3ToSphericalCoords(i);if(o.longitude=r.longitude,o.latitude=r.latitude,!this.prop.isCubemap){var n=this.sphericalCoordsToTextureCoords({longitude:o.longitude,latitude:o.latitude});o.texture_x=n.x,o.texture_y=n.y}this.prop.dblclick_timeout?(Math.abs(this.prop.dblclick_data.client_x-o.client_x)<PhotoSphereViewer.MOVE_THRESHOLD&&Math.abs(this.prop.dblclick_data.client_y-o.client_y)<PhotoSphereViewer.MOVE_THRESHOLD&&this.trigger("dblclick",this.prop.dblclick_data),clearTimeout(this.prop.dblclick_timeout),this.prop.dblclick_timeout=null,this.prop.dblclick_data=null):(this.trigger("click",o),this.prop.dblclick_data=PSVUtils.clone(o),this.prop.dblclick_timeout=setTimeout(function(){this.prop.dblclick_timeout=null,this.prop.dblclick_data=null}.bind(this),PhotoSphereViewer.DBLCLICK_DELAY))}},PhotoSphereViewer.prototype._move=function(t,e){if(this.prop.moving){var o=parseInt(t.clientX),i=parseInt(t.clientY);this.rotate({longitude:this.prop.longitude-(o-this.prop.mouse_x)/this.prop.size.width*this.prop.move_speed*this.prop.hFov,latitude:this.prop.latitude+(i-this.prop.mouse_y)/this.prop.size.height*this.prop.move_speed*this.prop.vFov}),this.prop.mouse_x=o,this.prop.mouse_y=i,!1!==e&&this._logMouseMove(t)}},PhotoSphereViewer.prototype._zoom=function(t){if(this.prop.zooming){var e=[{x:parseInt(t.touches[0].clientX),y:parseInt(t.touches[0].clientY)},{x:parseInt(t.touches[1].clientX),y:parseInt(t.touches[1].clientY)}],o=Math.sqrt(Math.pow(e[0].x-e[1].x,2)+Math.pow(e[0].y-e[1].y,2)),i=80*(o-this.prop.pinch_dist)/this.prop.size.width;this.zoom(this.prop.zoom_lvl+i),this.prop.pinch_dist=o}},PhotoSphereViewer.prototype._onMouseWheel=function(t){t.preventDefault(),t.stopPropagation();var e=void 0!==t.deltaY?-t.deltaY:void 0!==t.wheelDelta?t.wheelDelta:-t.detail;if(0!==e){var o=parseInt(e/Math.abs(e));this.zoom(this.prop.zoom_lvl+o)}},PhotoSphereViewer.prototype._fullscreenToggled=function(){var t=this.isFullscreenEnabled();this.config.keyboard&&(t?this.startKeyboardControl():this.stopKeyboardControl()),this.trigger("fullscreen-updated",t)},PhotoSphereViewer.prototype._logMouseMove=function(t){var e=Date.now();this.prop.mouse_history.push([e,t.clientX,t.clientY]);for(var o=null,i=0;i<this.prop.mouse_history.length;)this.prop.mouse_history[0][i]<e-PhotoSphereViewer.INERTIA_WINDOW?this.prop.mouse_history.splice(i,1):o&&this.prop.mouse_history[0][i]-o>PhotoSphereViewer.INERTIA_WINDOW/10?(this.prop.mouse_history.splice(0,i),i=0,o=this.prop.mouse_history[0][i]):(i++,o=this.prop.mouse_history[0][i])},PhotoSphereViewer.prototype.load=function(){if(!this.config.panorama)throw new PSVError("No value given for panorama.");return this.setPanorama(this.config.panorama,!1)},PhotoSphereViewer.prototype.getPosition=function(){return{longitude:this.prop.longitude,latitude:this.prop.latitude}},PhotoSphereViewer.prototype.getZoomLevel=function(){return this.prop.zoom_lvl},PhotoSphereViewer.prototype.getSize=function(){return{width:this.prop.size.width,height:this.prop.size.height}},PhotoSphereViewer.prototype.isAutorotateEnabled=function(){return!!this.prop.autorotate_reqid},PhotoSphereViewer.prototype.isGyroscopeEnabled=function(){return!!this.prop.orientation_reqid},PhotoSphereViewer.prototype.isFullscreenEnabled=function(){return PSVUtils.isFullscreenEnabled(this.container)},PhotoSphereViewer.prototype.render=function(t){!1!==t&&(this.prop.direction=this.sphericalCoordsToVector3(this.prop),this.camera.position.set(0,0,0),this.camera.lookAt(this.prop.direction)),this.config.fisheye&&this.camera.position.copy(this.prop.direction).multiplyScalar(this.config.fisheye/2).negate(),this.camera.aspect=this.prop.aspect,this.camera.fov=this.prop.vFov,this.camera.updateProjectionMatrix(),this.composer?this.composer.render():this.renderer.render(this.scene,this.camera),this.trigger("render")},PhotoSphereViewer.prototype.destroy=function(){this._stopAll(),this.stopKeyboardControl(),this.isFullscreenEnabled()&&PSVUtils.exitFullscreen(),window.removeEventListener("resize",this),this.config.mousemove&&(this.hud.container.removeEventListener("mousedown",this),this.hud.container.removeEventListener("touchstart",this),window.removeEventListener("mouseup",this),window.removeEventListener("touchend",this),this.hud.container.removeEventListener("mousemove",this),this.hud.container.removeEventListener("touchmove",this)),PhotoSphereViewer.SYSTEM.fullscreenEvent&&document.removeEventListener(PhotoSphereViewer.SYSTEM.fullscreenEvent,this),this.config.mousewheel&&this.hud.container.removeEventListener(PhotoSphereViewer.SYSTEM.mouseWheelEvent,this),this.tooltip&&this.tooltip.destroy(),this.hud&&this.hud.destroy(),this.loader&&this.loader.destroy(),this.navbar&&this.navbar.destroy(),this.panel&&this.panel.destroy(),this.doControls&&this.doControls.disconnect(),this.scene&&PSVUtils.cleanTHREEScene(this.scene),this.canvas_container&&this.container.removeChild(this.canvas_container),this.parent.removeChild(this.container),delete this.parent.photoSphereViewer,delete this.parent,delete this.container,delete this.loader,delete this.navbar,delete this.hud,delete this.panel,delete this.tooltip,delete this.canvas_container,delete this.renderer,delete this.composer,delete this.scene,delete this.camera,delete this.mesh,delete this.doControls,delete this.raycaster,delete this.passes,delete this.config,this.prop.cache.length=0},PhotoSphereViewer.prototype.setPanorama=function(t,e,o){if(null!==this.prop.loading_promise)throw new PSVError("Loading already in progress");if("boolean"==typeof e&&(o=e,e=void 0),o&&this.prop.isCubemap)throw new PSVError("Transition is not available with cubemap.");e&&(this.cleanPosition(e),this._stopAll()),this.config.panorama=t;var i=this;return o&&this.config.transition&&this.scene?(this.config.transition.loader&&this.loader.show(),this.prop.loading_promise=this._loadTexture(this.config.panorama).then(function(t){return i.loader.hide(),i._transition(t,e)}).ensure(function(){i.loader.hide(),i.prop.loading_promise=null}).rethrow()):(this.loader.show(),this.canvas_container&&(this.canvas_container.style.opacity=0),this.prop.loading_promise=this._loadTexture(this.config.panorama).then(function(t){i._setTexture(t),e&&i.rotate(e)}).ensure(function(){i.loader.hide(),i.canvas_container.style.opacity=1,i.prop.loading_promise=null}).rethrow()),this.prop.loading_promise},PhotoSphereViewer.prototype.startAutorotate=function(){this._stopAll();var t=this,e=null,o=null;!function i(r){r&&(o=null===e?0:r-e,e=r,t.rotate({longitude:t.prop.longitude+t.config.anim_speed*o/1e3,latitude:t.prop.latitude-(t.prop.latitude-t.config.anim_lat)/200})),t.prop.autorotate_reqid=window.requestAnimationFrame(i)}(null),this.trigger("autorotate",!0)},PhotoSphereViewer.prototype.stopAutorotate=function(){this.prop.start_timeout&&(window.clearTimeout(this.prop.start_timeout),this.prop.start_timeout=null),this.prop.autorotate_reqid&&(window.cancelAnimationFrame(this.prop.autorotate_reqid),this.prop.autorotate_reqid=null,this.trigger("autorotate",!1))},PhotoSphereViewer.prototype.toggleAutorotate=function(){this.isAutorotateEnabled()?this.stopAutorotate():this.startAutorotate()},PhotoSphereViewer.prototype.startGyroscopeControl=function(){if(this.doControls&&this.doControls.enabled&&this.doControls.deviceOrientation){this._stopAll();var t=this;!function e(){t.doControls.update(),t.prop.direction=t.camera.getWorldDirection();var o=t.vector3ToSphericalCoords(t.prop.direction);t.prop.longitude=o.longitude,t.prop.latitude=o.latitude,t.render(!1),t.prop.orientation_reqid=window.requestAnimationFrame(e)}(),this.trigger("gyroscope-updated",!0)}else console.warn("PhotoSphereViewer: gyroscope disabled")},PhotoSphereViewer.prototype.stopGyroscopeControl=function(){this.prop.orientation_reqid&&(window.cancelAnimationFrame(this.prop.orientation_reqid),this.prop.orientation_reqid=null,this.trigger("gyroscope-updated",!1),this.render())},PhotoSphereViewer.prototype.toggleGyroscopeControl=function(){this.isGyroscopeEnabled()?this.stopGyroscopeControl():this.startGyroscopeControl()},PhotoSphereViewer.prototype.rotate=function(t,e){this.cleanPosition(t),this.applyRanges(t).forEach(this.trigger.bind(this,"_side-reached")),this.prop.longitude=t.longitude,this.prop.latitude=t.latitude,!1!==e&&this.renderer&&(this.render(),this.trigger("position-updated",this.getPosition()))},PhotoSphereViewer.prototype.animate=function(t,e){if(this._stopAll(),!e)return this.rotate(t),D.resolved();this.cleanPosition(t),this.applyRanges(t).forEach(this.trigger.bind(this,"_side-reached")),e||"number"==typeof e||(e=e?PSVUtils.parseSpeed(e):this.config.anim_speed,e=Math.acos(Math.cos(this.prop.latitude)*Math.cos(t.latitude)*Math.cos(this.prop.longitude-t.longitude)+Math.sin(this.prop.latitude)*Math.sin(t.latitude))/e*1e3);var o=PSVUtils.getShortestArc(this.prop.longitude,t.longitude);return this.prop.animation_promise=PSVUtils.animation({properties:{longitude:{start:this.prop.longitude,end:this.prop.longitude+o},latitude:{start:this.prop.latitude,end:t.latitude}},duration:e,easing:"inOutSine",onTick:this.rotate.bind(this)}),this.prop.animation_promise},PhotoSphereViewer.prototype.stopAnimation=function(){this.prop.animation_promise&&(this.prop.animation_promise.cancel(),this.prop.animation_promise=null)},PhotoSphereViewer.prototype.zoom=function(t,e){this.prop.zoom_lvl=PSVUtils.bound(Math.round(t),0,100),this.prop.vFov=this.config.max_fov+this.prop.zoom_lvl/100*(this.config.min_fov-this.config.max_fov),this.prop.hFov=THREE.Math.radToDeg(2*Math.atan(Math.tan(THREE.Math.degToRad(this.prop.vFov)/2)*this.prop.aspect)),!1!==e&&this.renderer&&(this.render(),this.trigger("zoom-updated",this.getZoomLevel()))},PhotoSphereViewer.prototype.zoomIn=function(){this.prop.zoom_lvl<100&&this.zoom(this.prop.zoom_lvl+1)},PhotoSphereViewer.prototype.zoomOut=function(){this.prop.zoom_lvl>0&&this.zoom(this.prop.zoom_lvl-1)},PhotoSphereViewer.prototype.toggleFullscreen=function(){this.isFullscreenEnabled()?PSVUtils.exitFullscreen():PSVUtils.requestFullscreen(this.container)},PhotoSphereViewer.prototype.startKeyboardControl=function(){window.addEventListener("keydown",this)},PhotoSphereViewer.prototype.stopKeyboardControl=function(){window.removeEventListener("keydown",this)},PhotoSphereViewer.prototype.preloadPanorama=function(t){if(!this.config.cache_texture)throw new PSVError("Cannot preload panorama, cache_texture is disabled");return this._loadTexture(t)},PhotoSphereViewer.prototype.clearPanoramaCache=function(t){if(!this.config.cache_texture)throw new PSVError("Cannot clear cache, cache_texture is disabled");if(t){for(var e=0,o=this.prop.cache.length;e<o;e++)if(this.prop.cache[e].panorama===t){this.prop.cache.splice(e,1);break}}else this.prop.cache.length=0},PhotoSphereViewer.prototype.getPanoramaCache=function(t){if(!this.config.cache_texture)throw new PSVError("Cannot query cache, cache_texture is disabled");return this.prop.cache.filter(function(e){return e.panorama===t}).shift()},PhotoSphereViewer._loadSystem=function(){var t=PhotoSphereViewer.SYSTEM;t.loaded=!0,t.pixelRatio=window.devicePixelRatio||1,t.isWebGLSupported=PSVUtils.isWebGLSupported(),t.isCanvasSupported=PSVUtils.isCanvasSupported(),t.maxTextureWidth=t.isWebGLSupported?PSVUtils.getMaxTextureWidth():4096,t.mouseWheelEvent=PSVUtils.mouseWheelEvent(),t.fullscreenEvent=PSVUtils.fullscreenEvent(),t.deviceOrientationSupported=D(),"DeviceOrientationEvent"in window?window.addEventListener("deviceorientation",PhotoSphereViewer._deviceOrientationListener,!1):t.deviceOrientationSupported.reject()},PhotoSphereViewer._deviceOrientationListener=function(t){null===t.alpha||isNaN(t.alpha)?PhotoSphereViewer.SYSTEM.deviceOrientationSupported.reject():PhotoSphereViewer.SYSTEM.deviceOrientationSupported.resolve(),window.removeEventListener("deviceorientation",PhotoSphereViewer._deviceOrientationListener)},PhotoSphereViewer.prototype._setViewerSize=function(t){["width","height"].forEach(function(e){t[e]&&(/^[0-9.]+$/.test(t[e])&&(t[e]+="px"),this.parent.style[e]=t[e])},this)},PhotoSphereViewer.prototype.textureCoordsToSphericalCoords=function(t){if(this.prop.isCubemap)throw new PSVError("Unable to use texture coords with cubemap.");var e=(t.x+this.prop.pano_data.cropped_x)/this.prop.pano_data.full_width*PSVUtils.TwoPI,o=(t.y+this.prop.pano_data.cropped_y)/this.prop.pano_data.full_height*Math.PI;return{longitude:e>=Math.PI?e-Math.PI:e+Math.PI,latitude:PSVUtils.HalfPI-o}},PhotoSphereViewer.prototype.sphericalCoordsToTextureCoords=function(t){if(this.prop.isCubemap)throw new PSVError("Unable to use texture coords with cubemap.");var e=t.longitude/PSVUtils.TwoPI*this.prop.pano_data.full_width,o=t.latitude/Math.PI*this.prop.pano_data.full_height;return{x:parseInt(t.longitude<Math.PI?e+this.prop.pano_data.full_width/2:e-this.prop.pano_data.full_width/2)-this.prop.pano_data.cropped_x,y:parseInt(this.prop.pano_data.full_height/2-o)-this.prop.pano_data.cropped_y}},PhotoSphereViewer.prototype.sphericalCoordsToVector3=function(t){return new THREE.Vector3(PhotoSphereViewer.SPHERE_RADIUS*-Math.cos(t.latitude)*Math.sin(t.longitude),PhotoSphereViewer.SPHERE_RADIUS*Math.sin(t.latitude),PhotoSphereViewer.SPHERE_RADIUS*Math.cos(t.latitude)*Math.cos(t.longitude))},PhotoSphereViewer.prototype.vector3ToSphericalCoords=function(t){var e=Math.acos(t.y/Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z)),o=Math.atan2(t.x,t.z);return{longitude:o<0?-o:PSVUtils.TwoPI-o,latitude:PSVUtils.HalfPI-e}},PhotoSphereViewer.prototype.viewerCoordsToVector3=function(t){var e=new THREE.Vector2(2*t.x/this.prop.size.width-1,-2*t.y/this.prop.size.height+1);this.raycaster.setFromCamera(e,this.camera);var o=this.raycaster.intersectObjects(this.scene.children);return 1===o.length?o[0].point:null},PhotoSphereViewer.prototype.vector3ToViewerCoords=function(t){return(t=t.clone()).project(this.camera),{x:parseInt((t.x+1)/2*this.prop.size.width),y:parseInt((1-t.y)/2*this.prop.size.height)}},PhotoSphereViewer.prototype.cleanPosition=function(t){t.hasOwnProperty("x")&&t.hasOwnProperty("y")&&PSVUtils.deepmerge(t,this.textureCoordsToSphericalCoords(t)),t.longitude=PSVUtils.parseAngle(t.longitude),t.latitude=PSVUtils.bound(PSVUtils.parseAngle(t.latitude,-Math.PI),-PSVUtils.HalfPI,PSVUtils.HalfPI)},PhotoSphereViewer.prototype.applyRanges=function(t){var e,o,i=[];return this.config.longitude_range&&(e=PSVUtils.clone(this.config.longitude_range),o=THREE.Math.degToRad(this.prop.hFov)/2,e[0]=PSVUtils.parseAngle(e[0]+o),e[1]=PSVUtils.parseAngle(e[1]-o),e[0]>e[1]?t.longitude>e[1]&&t.longitude<e[0]&&(t.longitude>e[0]/2+e[1]/2?(t.longitude=e[0],i.push("left")):(t.longitude=e[1],i.push("right"))):t.longitude<e[0]?(t.longitude=e[0],i.push("left")):t.longitude>e[1]&&(t.longitude=e[1],i.push("right"))),this.config.latitude_range&&(e=PSVUtils.clone(this.config.latitude_range),o=THREE.Math.degToRad(this.prop.vFov)/2,e[0]=PSVUtils.parseAngle(Math.min(e[0]+o,e[1]),-Math.PI),e[1]=PSVUtils.parseAngle(Math.max(e[1]-o,e[0]),-Math.PI),t.latitude<e[0]?(t.latitude=e[0],i.push("bottom")):t.latitude>e[1]&&(t.latitude=e[1],i.push("top"))),i},PSVComponent.className=null,PSVComponent.publicMethods=[],PSVComponent.prototype.create=function(){this.container=document.createElement("div"),this.constructor.className&&(this.container.className=this.constructor.className),this.parent.container.appendChild(this.container)},PSVComponent.prototype.destroy=function(){this.parent.container.removeChild(this.container),this.constructor.publicMethods&&this.constructor.publicMethods.forEach(function(t){delete this.psv[t]},this),delete this.container,delete this.psv,delete this.parent},PSVComponent.prototype.hide=function(){this.container.style.display="none"},PSVComponent.prototype.show=function(){this.container.style.display=""},PSVHUD.prototype=Object.create(PSVComponent.prototype),PSVHUD.prototype.constructor=PSVHUD,PSVHUD.className="psv-hud",PSVHUD.publicMethods=["addMarker","removeMarker","updateMarker","clearMarkers","getMarker","getCurrentMarker","gotoMarker","hideMarker","showMarker","toggleMarker","toggleMarkersList","showMarkersList","hideMarkersList"],PSVHUD.prototype.create=function(){PSVComponent.prototype.create.call(this),this.svgContainer=document.createElementNS(PSVUtils.svgNS,"svg"),this.svgContainer.setAttribute("class","psv-hud-svg-container"),this.container.appendChild(this.svgContainer),this.container.addEventListener("mouseenter",this,!0),this.container.addEventListener("mouseleave",this,!0),this.container.addEventListener("mousemove",this,!0),this.psv.on("click",this),this.psv.on("dblclick",this),this.psv.on("render",this),this.psv.on("open-panel",this),this.psv.on("close-panel",this)},PSVHUD.prototype.destroy=function(){this.clearMarkers(!1),this.container.removeEventListener("mouseenter",this),this.container.removeEventListener("mouseleave",this),this.container.removeEventListener("mousemove",this),this.psv.off("click",this),this.psv.off("dblclick",this),this.psv.off("render",this),this.psv.off("open-panel",this),this.psv.off("close-panel",this),delete this.svgContainer,PSVComponent.prototype.destroy.call(this)},PSVHUD.prototype.handleEvent=function(t){switch(t.type){case"mouseenter":this._onMouseEnter(t);break;case"mouseleave":this._onMouseLeave(t);break;case"mousemove":this._onMouseMove(t);break;case"click":this._onClick(t.args[0],t,!1);break;case"dblclick":this._onClick(t.args[0],t,!0);break;case"render":this.renderMarkers();break;case"open-panel":this._onPanelOpened();break;case"close-panel":this._onPanelClosed()}},PSVHUD.prototype.addMarker=function(t,e){if(!t.id)throw new PSVError("missing marker id");if(this.markers[t.id])throw new PSVError('marker "'+t.id+'" already exists');var o=new PSVMarker(t,this.psv);return o.isNormal()?this.container.appendChild(o.$el):this.svgContainer.appendChild(o.$el),this.markers[o.id]=o,!1!==e&&this.renderMarkers(),o},PSVHUD.prototype.getMarker=function(t){var e="object"==typeof t?t.id:t;if(!this.markers[e])throw new PSVError('cannot find marker "'+e+'"');return this.markers[e]},PSVHUD.prototype.getCurrentMarker=function(){return this.currentMarker},PSVHUD.prototype.updateMarker=function(t,e){var o=this.getMarker(t);return o.update(t),!1!==e&&this.renderMarkers(),o},PSVHUD.prototype.removeMarker=function(t,e){(t=this.getMarker(t)).isNormal()?this.container.removeChild(t.$el):this.svgContainer.removeChild(t.$el),this.hoveringMarker==t&&this.psv.tooltip.hideTooltip(),t.destroy(),delete this.markers[t.id],!1!==e&&this.renderMarkers()},PSVHUD.prototype.clearMarkers=function(t){Object.keys(this.markers).forEach(function(t){this.removeMarker(t,!1)},this),!1!==t&&this.renderMarkers()},PSVHUD.prototype.gotoMarker=function(t,e){return t=this.getMarker(t),this.psv.animate(t,e)},PSVHUD.prototype.hideMarker=function(t){this.getMarker(t).visible=!1,this.renderMarkers()},PSVHUD.prototype.showMarker=function(t){this.getMarker(t).visible=!0,this.renderMarkers()},PSVHUD.prototype.toggleMarker=function(t){this.getMarker(t).visible^=!0,this.renderMarkers()},PSVHUD.prototype.toggleMarkersList=function(){this.prop.panelOpened?this.hideMarkersList():this.showMarkersList()},PSVHUD.prototype.showMarkersList=function(){var t=[];for(var e in this.markers)t.push(this.markers[e]);var o=this.psv.config.templates.markersList({markers:this.psv.change("render-markers-list",t),config:this.psv.config});this.prop.panelOpening=!0,this.psv.panel.showPanel(o,!0),this.psv.panel.container.querySelector(".psv-markers-list").addEventListener("click",this._onClickItem.bind(this))},PSVHUD.prototype.hideMarkersList=function(){this.prop.panelOpened&&this.psv.panel.hidePanel()},PSVHUD.prototype.renderMarkers=function(){var t=this.psv.isGyroscopeEnabled()?THREE.Math.radToDeg(this.psv.camera.rotation.z):0;for(var e in this.markers){var o=this.markers[e],i=o.visible;if(i&&o.isPolygon()){var r=this._getPolygonPositions(o);if(i=r.length>2){o.position2D=this._getPolygonDimensions(o,r);var n="";r.forEach(function(t){n+=t.x+","+t.y+" "}),o.$el.setAttributeNS(null,"points",n)}}else if(i){var s=this._getMarkerPosition(o);(i=this._isMarkerVisible(o,s))&&(o.position2D=s,o.$el instanceof SVGElement?o.$el.setAttribute("transform","translate("+s.x+" "+s.y+")"+(!o.lockRotation&&t?" rotate("+t+" "+o.anchor.left*o.width+" "+o.anchor.top*o.height+")":"")):(o.$el.style.transform="translate3D("+s.x+"px, "+s.y+"px, 0px)"+(!o.lockRotation&&t?" rotateZ("+t+"deg)":""),o.$el.style.transformOrigin=100*o.anchor.left+"% "+100*o.anchor.top+"%"))}PSVUtils.toggleClass(o.$el,"psv-marker--visible",i)}},PSVHUD.prototype._isMarkerVisible=function(t,e){return t.position3D.dot(this.psv.prop.direction)>0&&e.x+t.width>=0&&e.x-t.width<=this.psv.prop.size.width&&e.y+t.height>=0&&e.y-t.height<=this.psv.prop.size.height},PSVHUD.prototype._getMarkerPosition=function(t){if(t._dynamicSize){PSVUtils.toggleClass(t.$el,"psv-marker--transparent",!0);var e=t.$el.getBoundingClientRect();PSVUtils.toggleClass(t.$el,"psv-marker--transparent",!1),t.width=e.right-e.left,t.height=e.bottom-e.top}var o=this.psv.vector3ToViewerCoords(t.position3D);return o.x-=t.width*t.anchor.left,o.y-=t.height*t.anchor.top,o},PSVHUD.prototype._getPolygonPositions=function(t){var e=t.positions3D.length,o=t.positions3D.map(function(t){return{vector:t,visible:t.dot(this.psv.prop.direction)>0}},this),i=[];return o.forEach(function(t,r){t.visible||[0===r?o[e-1]:o[r-1],r===e-1?o[0]:o[r+1]].forEach(function(e){e.visible&&i.push({visible:e,invisible:t,index:r})})}),i.reverse().forEach(function(t){o.splice(t.index,0,{vector:this._getPolygonIntermediaryPoint(t.visible.vector,t.invisible.vector),visible:!0})},this),o.filter(function(t){return t.visible}).map(function(t){return this.psv.vector3ToViewerCoords(t.vector)},this)},PSVHUD.prototype._getPolygonIntermediaryPoint=function(t,e){var o=this.psv.prop.direction.clone().normalize(),i=(new THREE.Vector3).crossVectors(t,e).normalize(),r=(new THREE.Vector3).crossVectors(i,t).normalize(),n=(new THREE.Vector3).addVectors(t.clone().multiplyScalar(-o.dot(r)),r.clone().multiplyScalar(o.dot(t))).normalize(),s=(new THREE.Vector3).crossVectors(n,o);return n.applyAxisAngle(s,.01).multiplyScalar(PhotoSphereViewer.SPHERE_RADIUS)},PSVHUD.prototype._getPolygonDimensions=function(t,e){var o=1/0,i=1/0,r=-1/0,n=-1/0;return e.forEach(function(t){o=Math.min(o,t.x),i=Math.min(i,t.y),r=Math.max(r,t.x),n=Math.max(n,t.y)}),t.width=r-o,t.height=n-i,{x:o,y:i}},PSVHUD.prototype._onMouseEnter=function(t){var e;t.target&&(e=t.target.psvMarker)&&!e.isPolygon()&&(this.hoveringMarker=e,this.psv.trigger("over-marker",e),e.tooltip&&this.psv.tooltip.showTooltip({content:e.tooltip.content,position:e.tooltip.position,left:e.position2D.x,top:e.position2D.y,box:{width:e.width,height:e.height}}))},PSVHUD.prototype._onMouseLeave=function(t){var e;if(t.target&&(e=t.target.psvMarker)){if(e.isPolygon()&&t.relatedTarget&&PSVUtils.hasParent(t.relatedTarget,this.psv.tooltip.container))return;this.psv.trigger("leave-marker",e),this.hoveringMarker=null,this.psv.tooltip.hideTooltip()}},PSVHUD.prototype._onMouseMove=function(t){if(!this.psv.prop.moving){var e;if(t.target&&(e=t.target.psvMarker)&&e.isPolygon()||t.target&&PSVUtils.hasParent(t.target,this.psv.tooltip.container)&&(e=this.hoveringMarker)){this.hoveringMarker||(this.psv.trigger("over-marker",e),this.hoveringMarker=e);var o=this.psv.container.getBoundingClientRect();e.tooltip&&this.psv.tooltip.showTooltip({content:e.tooltip.content,position:e.tooltip.position,top:t.clientY-o.top-this.psv.config.tooltip.arrow_size/2,left:t.clientX-o.left-this.psv.config.tooltip.arrow_size,box:{width:2*this.psv.config.tooltip.arrow_size,height:2*this.psv.config.tooltip.arrow_size}})}else this.hoveringMarker&&this.hoveringMarker.isPolygon()&&(this.psv.trigger("leave-marker",e),this.hoveringMarker=null,this.psv.tooltip.hideTooltip())}},PSVHUD.prototype._onClick=function(t,e,o){var i;t.target&&(i=PSVUtils.getClosest(t.target,".psv-marker"))&&i.psvMarker?(this.currentMarker=i.psvMarker,this.psv.trigger("select-marker",this.currentMarker,o),this.psv.config.click_event_on_marker?t.marker=i.psvMarker:e.stopPropagation()):this.currentMarker&&(this.psv.trigger("unselect-marker",this.currentMarker),this.currentMarker=null),i&&i.psvMarker&&i.psvMarker.content?this.psv.panel.showPanel(i.psvMarker.content):this.psv.panel.prop.opened&&(e.stopPropagation(),this.psv.panel.hidePanel())},PSVHUD.prototype._onClickItem=function(t){var e;t.target&&(e=PSVUtils.getClosest(t.target,"li"))&&e.dataset.psvMarker&&(this.gotoMarker(e.dataset.psvMarker,1e3),this.psv.panel.hidePanel())},PSVHUD.prototype._onPanelOpened=function(){this.prop.panelOpening?(this.prop.panelOpening=!1,this.prop.panelOpened=!0):this.prop.panelOpened=!1,this.prop.markersButton&&this.prop.markersButton.toggleActive(this.prop.panelOpened)},PSVHUD.prototype._onPanelClosed=function(){this.prop.panelOpened=!1,this.prop.panelOpening=!1,this.prop.markersButton&&this.prop.markersButton.toggleActive(!1)},PSVLoader.prototype=Object.create(PSVComponent.prototype),PSVLoader.prototype.constructor=PSVLoader,PSVLoader.className="psv-loader-container",PSVLoader.prototype.create=function(){PSVComponent.prototype.create.call(this),this.loader=document.createElement("div"),this.loader.className="psv-loader",this.container.appendChild(this.loader),this.canvas=document.createElement("canvas"),this.canvas.className="psv-loader-canvas",this.canvas.width=this.loader.clientWidth,this.canvas.height=this.loader.clientWidth,this.loader.appendChild(this.canvas),this.tickness=(this.loader.offsetWidth-this.loader.clientWidth)/2;var t;if(this.psv.config.loading_img?((t=document.createElement("img")).className="psv-loader-image",t.src=this.psv.config.loading_img):this.psv.config.loading_txt&&((t=document.createElement("div")).className="psv-loader-text",t.innerHTML=this.psv.config.loading_txt),t){var e=Math.round(Math.sqrt(2*Math.pow(this.canvas.width/2-this.tickness/2,2)));t.style.maxWidth=e+"px",t.style.maxHeight=e+"px",this.loader.appendChild(t)}},PSVLoader.prototype.destroy=function(){delete this.loader,delete this.canvas,PSVComponent.prototype.destroy.call(this)},PSVLoader.prototype.setProgress=function(t){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),e.lineWidth=this.tickness,e.strokeStyle=PSVUtils.getStyle(this.loader,"color"),e.beginPath(),e.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2-this.tickness/2,-Math.PI/2,t/100*2*Math.PI-Math.PI/2),e.stroke()},PSVNavBar.prototype=Object.create(PSVComponent.prototype),PSVNavBar.prototype.constructor=PSVNavBar,PSVNavBar.className="psv-navbar psv-navbar--open",PSVNavBar.publicMethods=["showNavbar","hideNavbar","toggleNavbar","getNavbarButton"],PSVNavBar.prototype.create=function(){PSVComponent.prototype.create.call(this),this.config.forEach(function(t){if("object"==typeof t)this.items.push(new PSVNavBarCustomButton(this,t));else switch(t){case PSVNavBarAutorotateButton.id:this.items.push(new PSVNavBarAutorotateButton(this));break;case PSVNavBarZoomButton.id:this.items.push(new PSVNavBarZoomButton(this));break;case PSVNavBarDownloadButton.id:this.items.push(new PSVNavBarDownloadButton(this));break;case PSVNavBarMarkersButton.id:this.items.push(new PSVNavBarMarkersButton(this));break;case PSVNavBarFullscreenButton.id:this.items.push(new PSVNavBarFullscreenButton(this));break;case PSVNavBarGyroscopeButton.id:this.psv.config.gyroscope&&this.items.push(new PSVNavBarGyroscopeButton(this));break;case"caption":this.items.push(new PSVNavBarCaption(this,this.psv.config.caption));break;case"spacer":t="spacer-5";default:var e=t.match(/^spacer\-([0-9]+)$/);if(null===e)throw new PSVError("Unknown button "+t);this.items.push(new PSVNavBarSpacer(this,e[1]))}},this)},PSVNavBar.prototype.destroy=function(){this.items.forEach(function(t){t.destroy()}),delete this.items,delete this.config,PSVComponent.prototype.destroy.call(this)},PSVNavBar.prototype.getNavbarButton=function(t){var e=null;return this.items.some(function(o){if(o.id===t)return e=o,!0}),e||console.warn('PhotoSphereViewer: button "'+t+'" not found in the navbar.'),e},PSVNavBar.prototype.showNavbar=function(){this.toggleNavbar(!0)},PSVNavBar.prototype.hideNavbar=function(){this.toggleNavbar(!1)},PSVNavBar.prototype.toggleNavbar=function(t){PSVUtils.toggleClass(this.container,"psv-navbar--open",t)},PSVNavBarCaption.prototype=Object.create(PSVComponent.prototype),PSVNavBarCaption.prototype.constructor=PSVNavBarCaption,PSVNavBarCaption.className="psv-caption",PSVNavBarCaption.publicMethods=["setCaption"],PSVNavBarCaption.prototype.setCaption=function(t){this.container.innerHTML=t||""},PSVNavBarSpacer.prototype=Object.create(PSVComponent.prototype),PSVNavBarSpacer.prototype.constructor=PSVNavBarSpacer,PSVNavBarSpacer.className="psv-spacer",PSVPanel.prototype=Object.create(PSVComponent.prototype),PSVPanel.prototype.constructor=PSVPanel,PSVPanel.className="psv-panel",PSVPanel.publicMethods=["showPanel","hidePanel"],PSVPanel.prototype.create=function(){PSVComponent.prototype.create.call(this),this.container.innerHTML='<div class="psv-panel-resizer"></div><div class="psv-panel-close-button"></div><div class="psv-panel-content"></div>',this.content=this.container.querySelector(".psv-panel-content"),this.container.querySelector(".psv-panel-close-button").addEventListener("click",this.hidePanel.bind(this)),this.psv.config.mousewheel&&this.container.addEventListener(PhotoSphereViewer.SYSTEM.mouseWheelEvent,function(t){t.stopPropagation()});var t=this.container.querySelector(".psv-panel-resizer");t.addEventListener("mousedown",this),t.addEventListener("touchstart",this),this.psv.container.addEventListener("mouseup",this),this.psv.container.addEventListener("touchend",this),this.psv.container.addEventListener("mousemove",this),this.psv.container.addEventListener("touchmove",this)},PSVPanel.prototype.destroy=function(){this.psv.container.removeEventListener("mousemove",this),this.psv.container.removeEventListener("touchmove",this),this.psv.container.removeEventListener("mouseup",this),this.psv.container.removeEventListener("touchend",this),delete this.prop,delete this.content,PSVComponent.prototype.destroy.call(this)},PSVPanel.prototype.handleEvent=function(t){switch(t.type){case"mousedown":this._onMouseDown(t);break;case"touchstart":this._onTouchStart(t);break;case"mousemove":this._onMouseMove(t);break;case"touchmove":this._onTouchMove(t);break;case"mouseup":case"touchend":this._onMouseUp(t)}},PSVPanel.prototype.showPanel=function(t,e){this.content.innerHTML=t,this.content.scrollTop=0,this.container.classList.add("psv-panel--open"),PSVUtils.toggleClass(this.content,"psv-panel-content--no-margin",!!e),this.prop.opened=!0,this.psv.trigger("open-panel")},PSVPanel.prototype.hidePanel=function(){this.content.innerHTML=null,this.prop.opened=!1,this.container.classList.remove("psv-panel--open"),this.psv.trigger("close-panel")},PSVPanel.prototype._onMouseDown=function(t){t.stopPropagation(),this._startResize(t)},PSVPanel.prototype._onTouchStart=function(t){t.stopPropagation(),this._startResize(t.changedTouches[0])},PSVPanel.prototype._onMouseUp=function(t){this.prop.mousedown&&(t.stopPropagation(),this.prop.mousedown=!1,this.content.classList.remove("psv-panel-content--no-interaction"))},PSVPanel.prototype._onMouseMove=function(t){this.prop.mousedown&&(t.stopPropagation(),this._resize(t))},PSVPanel.prototype._onTouchMove=function(t){this.prop.mousedown&&(t.stopPropagation(),this._resize(t.touches[0]))},PSVPanel.prototype._startResize=function(t){this.prop.mouse_x=parseInt(t.clientX),this.prop.mouse_y=parseInt(t.clientY),this.prop.mousedown=!0,this.content.classList.add("psv-panel-content--no-interaction")},PSVPanel.prototype._resize=function(t){var e=parseInt(t.clientX),o=parseInt(t.clientY);this.container.style.width=this.container.offsetWidth-(e-this.prop.mouse_x)+"px",this.prop.mouse_x=e,this.prop.mouse_y=o},PSVTooltip.prototype=Object.create(PSVComponent.prototype),PSVTooltip.prototype.constructor=PSVTooltip,PSVTooltip.className="psv-tooltip",PSVTooltip.publicMethods=["showTooltip","hideTooltip","isTooltipVisible"],PSVTooltip.leftMap={0:"left",.5:"center",1:"right"},PSVTooltip.topMap={0:"top",.5:"center",1:"bottom"},PSVTooltip.prototype.create=function(){PSVComponent.prototype.create.call(this),this.container.innerHTML='<div class="psv-tooltip-arrow"></div><div class="psv-tooltip-content"></div>',this.container.style.top="-1000px",this.container.style.left="-1000px",this.content=this.container.querySelector(".psv-tooltip-content"),this.arrow=this.container.querySelector(".psv-tooltip-arrow"),this.psv.on("render",this)},PSVTooltip.prototype.destroy=function(){this.psv.off("render",this),delete this.config,delete this.prop,PSVComponent.prototype.destroy.call(this)},PSVTooltip.prototype.handleEvent=function(t){switch(t.type){case"render":this.hideTooltip()}},PSVTooltip.prototype.isTooltipVisible=function(){return this.container.classList.contains("psv-tooltip--visible")},PSVTooltip.prototype.showTooltip=function(t){this.prop.timeout&&(window.clearTimeout(this.prop.timeout),this.prop.timeout=null);var e=this.isTooltipVisible(),o=this.container,i=this.content,r=this.arrow;if(t.position||(t.position=["top","center"]),t.box||(t.box={width:0,height:0}),"string"==typeof t.position){var n=PSVUtils.parsePosition(t.position);if(!(n.left in PSVTooltip.leftMap&&n.top in PSVTooltip.topMap))throw new PSVError('unable to parse tooltip position "'+tooltip.position+'"');t.position=[PSVTooltip.topMap[n.top],PSVTooltip.leftMap[n.left]]}if("center"==t.position[0]&&"center"==t.position[1])throw new PSVError('unable to parse tooltip position "center center"');if(e)for(var s=o.classList.length-1;s>=0;s--){var a=o.classList.item(s);"psv-tooltip"!=a&&"psv-tooltip--visible"!=a&&o.classList.remove(a)}else o.className="psv-tooltip";t.className&&PSVUtils.addClasses(o,t.className),i.innerHTML=t.content,o.style.top="0px",o.style.left="0px";var h=o.getBoundingClientRect(),p={posClass:t.position.slice(),width:h.right-h.left,height:h.bottom-h.top,top:0,left:0,arrow_top:0,arrow_left:0};this._computeTooltipPosition(p,t);var l=!1;if(p.top<this.config.offset?(p.posClass[0]="bottom",l=!0):p.top+p.height>this.psv.prop.size.height-this.config.offset&&(p.posClass[0]="top",l=!0),p.left<this.config.offset?(p.posClass[1]="right",l=!0):p.left+p.width>this.psv.prop.size.width-this.config.offset&&(p.posClass[1]="left",l=!0),l&&this._computeTooltipPosition(p,t),o.style.top=p.top+"px",o.style.left=p.left+"px",r.style.top=p.arrow_top+"px",r.style.left=p.arrow_left+"px",o.classList.add("psv-tooltip--"+p.posClass.join("-")),!e){var c=this;this.prop.timeout=window.setTimeout(function(){o.classList.add("psv-tooltip--visible"),c.prop.timeout=null,c.psv.trigger("show-tooltip")},this.config.delay)}},PSVTooltip.prototype.hideTooltip=function(){if(this.prop.timeout&&(window.clearTimeout(this.prop.timeout),this.prop.timeout=null),this.isTooltipVisible()){this.container.classList.remove("psv-tooltip--visible");var t=this;this.prop.timeout=window.setTimeout(function(){t.content.innerHTML=null,t.container.style.top="-1000px",t.container.style.left="-1000px",t.prop.timeout=null},this.config.delay),this.psv.trigger("hide-tooltip")}},PSVTooltip.prototype._computeTooltipPosition=function(t,e){var o=!1;switch(t.posClass[0]){case"bottom":t.top=e.top+e.box.height+this.config.offset+this.config.arrow_size,t.arrow_top=2*-this.config.arrow_size,o=!0;break;case"center":t.top=e.top+e.box.height/2-t.height/2,t.arrow_top=t.height/2-this.config.arrow_size;break;case"top":t.top=e.top-t.height-this.config.offset-this.config.arrow_size,t.arrow_top=t.height,o=!0}switch(t.posClass[1]){case"right":o?(t.left=e.left+e.box.width/2-this.config.offset-this.config.arrow_size,t.arrow_left=this.config.offset):(t.left=e.left+e.box.width+this.config.offset+this.config.arrow_size,t.arrow_left=2*-this.config.arrow_size);break;case"center":t.left=e.left+e.box.width/2-t.width/2,t.arrow_left=t.width/2-this.config.arrow_size;break;case"left":o?(t.left=e.left-t.width+e.box.width/2+this.config.offset+this.config.arrow_size,t.arrow_left=t.width-this.config.offset-2*this.config.arrow_size):(t.left=e.left-t.width-this.config.offset-this.config.arrow_size,t.arrow_left=t.width)}},PSVNavBarButton.prototype=Object.create(PSVComponent.prototype),PSVNavBarButton.prototype.constructor=PSVNavBarButton,PSVNavBarButton.id=null,PSVNavBarButton.icon=null,PSVNavBarButton.iconActive=null,PSVNavBarButton.prototype.create=function(){PSVComponent.prototype.create.call(this),this.constructor.icon&&this._setIcon(this.constructor.icon),this.id&&this.psv.config.lang[this.id]&&(this.container.title=this.psv.config.lang[this.id]),this.container.addEventListener("click",function(t){this.enabled&&this._onClick(),t.stopPropagation()}.bind(this))},PSVNavBarButton.prototype.destroy=function(){PSVComponent.prototype.destroy.call(this)},PSVNavBarButton.prototype.toggleActive=function(t){PSVUtils.toggleClass(this.container,"psv-button--active",t),this.constructor.iconActive&&this._setIcon(t?this.constructor.iconActive:this.constructor.icon)},PSVNavBarButton.prototype.disable=function(){this.container.classList.add("psv-button--disabled"),this.enabled=!1},PSVNavBarButton.prototype.enable=function(){this.container.classList.remove("psv-button--disabled"),this.enabled=!0},PSVNavBarButton.prototype._setIcon=function(t,e){e||(e=this.container),t?(e.innerHTML=PhotoSphereViewer.ICONS[t],e.querySelector("svg").setAttribute("class","psv-button-svg")):e.innerHTML=""},PSVNavBarButton.prototype._onClick=function(){},PSVNavBarAutorotateButton.prototype=Object.create(PSVNavBarButton.prototype),PSVNavBarAutorotateButton.prototype.constructor=PSVNavBarAutorotateButton,PSVNavBarAutorotateButton.id="autorotate",PSVNavBarAutorotateButton.className="psv-button psv-button--hover-scale psv-autorotate-button",PSVNavBarAutorotateButton.icon="play.svg",PSVNavBarAutorotateButton.iconActive="play-active.svg",PSVNavBarAutorotateButton.prototype.create=function(){PSVNavBarButton.prototype.create.call(this),this.psv.on("autorotate",this)},PSVNavBarAutorotateButton.prototype.destroy=function(){this.psv.off("autorotate",this),PSVNavBarButton.prototype.destroy.call(this)},PSVNavBarAutorotateButton.prototype.handleEvent=function(t){switch(t.type){case"autorotate":this.toggleActive(t.args[0])}},PSVNavBarAutorotateButton.prototype._onClick=function(){this.psv.toggleAutorotate()},PSVNavBarCustomButton.prototype=Object.create(PSVNavBarButton.prototype),PSVNavBarCustomButton.prototype.constructor=PSVNavBarCustomButton,PSVNavBarCustomButton.className="psv-button psv-custom-button",PSVNavBarCustomButton.prototype.create=function(){PSVNavBarButton.prototype.create.call(this),this.config.className&&PSVUtils.addClasses(this.container,this.config.className),this.config.title&&(this.container.title=this.config.title),this.config.content&&(this.container.innerHTML=this.config.content),!1!==this.config.enabled&&!0!==this.config.disabled||this.disable(),!1!==this.config.visible&&!0!==this.config.hidden||this.hide()},PSVNavBarCustomButton.prototype.destroy=function(){delete this.config,PSVNavBarButton.prototype.destroy.call(this)},PSVNavBarCustomButton.prototype._onClick=function(){this.config.onClick&&this.config.onClick.apply(this.psv)},PSVNavBarDownloadButton.prototype=Object.create(PSVNavBarButton.prototype),PSVNavBarDownloadButton.prototype.constructor=PSVNavBarDownloadButton,PSVNavBarDownloadButton.id="download",PSVNavBarDownloadButton.className="psv-button psv-button--hover-scale psv-download-button",PSVNavBarDownloadButton.icon="download.svg",PSVNavBarDownloadButton.prototype._onClick=function(){var t=document.createElement("a");t.href=this.psv.config.panorama,t.download=this.psv.config.panorama,this.psv.container.appendChild(t),t.click()},PSVNavBarFullscreenButton.prototype=Object.create(PSVNavBarButton.prototype),PSVNavBarFullscreenButton.prototype.constructor=PSVNavBarFullscreenButton,PSVNavBarFullscreenButton.id="fullscreen",PSVNavBarFullscreenButton.className="psv-button psv-button--hover-scale psv-fullscreen-button",PSVNavBarFullscreenButton.icon="fullscreen-in.svg",PSVNavBarFullscreenButton.iconActive="fullscreen-out.svg",PSVNavBarFullscreenButton.prototype.create=function(){PSVNavBarButton.prototype.create.call(this),PhotoSphereViewer.SYSTEM.fullscreenEvent||(this.hide(),console.warn("PhotoSphereViewer: fullscreen not supported.")),this.psv.on("fullscreen-updated",this)},PSVNavBarFullscreenButton.prototype.destroy=function(){this.psv.off("fullscreen-updated",this),PSVNavBarButton.prototype.destroy.call(this)},PSVNavBarFullscreenButton.prototype.handleEvent=function(t){switch(t.type){case"fullscreen-updated":this.toggleActive(t.args[0])}},PSVNavBarFullscreenButton.prototype._onClick=function(){this.psv.toggleFullscreen()},PSVNavBarGyroscopeButton.prototype=Object.create(PSVNavBarButton.prototype),PSVNavBarGyroscopeButton.prototype.constructor=PSVNavBarGyroscopeButton,PSVNavBarGyroscopeButton.id="gyroscope",PSVNavBarGyroscopeButton.className="psv-button psv-button--hover-scale psv-gyroscope-button",PSVNavBarGyroscopeButton.icon="compass.svg",PSVNavBarGyroscopeButton.prototype.create=function(){PSVNavBarButton.prototype.create.call(this),PhotoSphereViewer.SYSTEM.deviceOrientationSupported.promise.then(this._onAvailabilityChange.bind(this,!0),this._onAvailabilityChange.bind(this,!1)),this.hide(),this.psv.on("gyroscope-updated",this)},PSVNavBarGyroscopeButton.prototype.destroy=function(){this.psv.off("gyroscope-updated",this),PSVNavBarButton.prototype.destroy.call(this)},PSVNavBarGyroscopeButton.prototype.handleEvent=function(t){switch(t.type){case"gyroscope-updated":this.toggleActive(t.args[0])}},PSVNavBarGyroscopeButton.prototype._onClick=function(){this.psv.toggleGyroscopeControl()},PSVNavBarGyroscopeButton.prototype._onAvailabilityChange=function(t){if(t){if(!PSVUtils.checkTHREE("DeviceOrientationControls"))throw new PSVError("Missing Three.js components: DeviceOrientationControls. Get them from three.js-examples package.");this.show()}},PSVNavBarMarkersButton.prototype=Object.create(PSVNavBarButton.prototype),PSVNavBarMarkersButton.prototype.constructor=PSVNavBarMarkersButton,PSVNavBarMarkersButton.id="markers",PSVNavBarMarkersButton.className="psv-button psv-button--hover-scale psv-markers-button",PSVNavBarMarkersButton.icon="pin.svg",PSVNavBarMarkersButton.prototype._onClick=function(){this.psv.hud.toggleMarkersList()},PSVNavBarZoomButton.prototype=Object.create(PSVNavBarButton.prototype),PSVNavBarZoomButton.prototype.constructor=PSVNavBarZoomButton,PSVNavBarZoomButton.id="zoom",PSVNavBarZoomButton.className="psv-button psv-zoom-button",PSVNavBarZoomButton.prototype.create=function(){PSVNavBarButton.prototype.create.call(this);var t=document.createElement("div");t.className="psv-zoom-button-minus",t.title=this.psv.config.lang.zoomOut,this._setIcon("zoom-out.svg",t),this.container.appendChild(t);var e=document.createElement("div");e.className="psv-zoom-button-range",this.container.appendChild(e),this.zoom_range=document.createElement("div"),this.zoom_range.className="psv-zoom-button-line",e.appendChild(this.zoom_range),this.zoom_value=document.createElement("div"),this.zoom_value.className="psv-zoom-button-handle",this.zoom_range.appendChild(this.zoom_value);var o=document.createElement("div");o.className="psv-zoom-button-plus",o.title=this.psv.config.lang.zoomIn,this._setIcon("zoom-in.svg",o),this.container.appendChild(o),this.zoom_range.addEventListener("mousedown",this),this.zoom_range.addEventListener("touchstart",this),this.psv.container.addEventListener("mousemove",this),this.psv.container.addEventListener("touchmove",this),this.psv.container.addEventListener("mouseup",this),this.psv.container.addEventListener("touchend",this),t.addEventListener("mousedown",this._zoomOut.bind(this)),o.addEventListener("mousedown",this._zoomIn.bind(this)),this.psv.on("zoom-updated",this),this.psv.once("ready",function(){this._moveZoomValue(this.psv.prop.zoom_lvl)}.bind(this))},PSVNavBarZoomButton.prototype.destroy=function(){this.psv.container.removeEventListener("mousemove",this),this.psv.container.removeEventListener("touchmove",this),this.psv.container.removeEventListener("mouseup",this),this.psv.container.removeEventListener("touchend",this),delete this.zoom_range,delete this.zoom_value,this.psv.off("zoom-updated",this),PSVNavBarButton.prototype.destroy.call(this)},PSVNavBarZoomButton.prototype.handleEvent=function(t){switch(t.type){case"mousedown":this._initZoomChangeWithMouse(t);break;case"touchstart":this._initZoomChangeByTouch(t);break;case"mousemove":this._changeZoomWithMouse(t);break;case"touchmove":this._changeZoomByTouch(t);break;case"mouseup":case"touchend":this._stopZoomChange(t);break;case"zoom-updated":this._moveZoomValue(t.args[0])}},PSVNavBarZoomButton.prototype._moveZoomValue=function(t){this.zoom_value.style.left=t/100*this.zoom_range.offsetWidth-this.zoom_value.offsetWidth/2+"px"},PSVNavBarZoomButton.prototype._initZoomChangeWithMouse=function(t){this.enabled&&(this.prop.mousedown=!0,this._changeZoom(t.clientX))},PSVNavBarZoomButton.prototype._initZoomChangeByTouch=function(t){this.enabled&&(this.prop.mousedown=!0,this._changeZoom(t.changedTouches[0].clientX))},PSVNavBarZoomButton.prototype._zoomIn=function(){this.enabled&&(this.prop.buttondown=!0,this.psv.zoomIn(),window.setTimeout(this._startLongPressInterval.bind(this,1),200))},PSVNavBarZoomButton.prototype._zoomOut=function(){this.enabled&&(this.prop.buttondown=!0,this.psv.zoomOut(),window.setTimeout(this._startLongPressInterval.bind(this,-1),200))},PSVNavBarZoomButton.prototype._startLongPressInterval=function(t){this.prop.buttondown&&(this.prop.longPressInterval=window.setInterval(function(){this.psv.zoom(this.psv.prop.zoom_lvl+t)}.bind(this),50))},PSVNavBarZoomButton.prototype._stopZoomChange=function(){this.enabled&&(window.clearInterval(this.prop.longPressInterval),this.prop.longPressInterval=null,this.prop.mousedown=!1,this.prop.buttondown=!1)},PSVNavBarZoomButton.prototype._changeZoomWithMouse=function(t){this.enabled&&(t.preventDefault(),this._changeZoom(t.clientX))},PSVNavBarZoomButton.prototype._changeZoomByTouch=function(t){this.enabled&&(t.preventDefault(),this._changeZoom(t.changedTouches[0].clientX))},PSVNavBarZoomButton.prototype._changeZoom=function(t){if(this.prop.mousedown){var e=(parseInt(t)-this.zoom_range.getBoundingClientRect().left)/this.zoom_range.offsetWidth*100;this.psv.zoom(e)}},PSVError.prototype=Object.create(Error.prototype),PSVError.prototype.name="PSVError",PSVError.prototype.constructor=PSVError,PhotoSphereViewer.Error=PSVError,PSVMarker.types=["image","html","polygon_px","polygon_rad","rect","circle","ellipse","path"],PSVMarker.getType=function(t,e){var o=[];if(PSVMarker.types.forEach(function(e){t[e]&&o.push(e)}),0===o.length&&!e)throw new PSVError("missing marker content, either "+PSVMarker.types.join(", "));if(o.length>1)throw new PSVError("multiple marker content, either "+PSVMarker.types.join(", "));return o[0]},PSVMarker.prototype.destroy=function(){delete this.$el.psvMarker},PSVMarker.prototype.isNormal=function(){return"image"==this.type||"html"==this.type},PSVMarker.prototype.isPolygon=function(){return"polygon_px"==this.type||"polygon_rad"==this.type},PSVMarker.prototype.isSvg=function(){return"rect"==this.type||"circle"==this.type||"ellipse"==this.type||"path"==this.type},PSVMarker.prototype.update=function(t){if(t&&t!==this){var e=PSVMarker.getType(t,!0);if(void 0!==e&&e!==this.type)throw new PSVError("cannot change marker type");PSVUtils.deepmerge(this,t)}this.isNormal()?this.$el.setAttribute("class","psv-marker psv-marker--normal"):this.$el.setAttribute("class","psv-marker psv-marker--svg"),this.className&&PSVUtils.addClasses(this.$el,this.className),this.tooltip&&(PSVUtils.addClasses(this.$el,"has-tooltip"),"string"==typeof this.tooltip&&(this.tooltip={content:this.tooltip})),this.style&&PSVUtils.deepmerge(this.$el.style,this.style),this.anchor=PSVUtils.parsePosition(this.anchor),this.isNormal()?this._updateNormal():this.isPolygon()?this._updatePolygon():this._updateSvg()},PSVMarker.prototype._updateNormal=function(){this.width&&this.height?(this.$el.style.width=this.width+"px",this.$el.style.height=this.height+"px",this._dynamicSize=!1):this._dynamicSize=!0,this.image?this.$el.style.backgroundImage="url("+this.image+")":this.$el.innerHTML=this.html,this.psv.cleanPosition(this),this.position3D=this.psv.sphericalCoordsToVector3(this)},PSVMarker.prototype._updateSvg=function(){switch(this._dynamicSize=!0,this.type){case"rect":"number"==typeof this._def?this._def={x:0,y:0,width:this._def,height:this._def}:Array.isArray(this._def)?this._def={x:0,y:0,width:this._def[0],height:this._def[1]}:this._def.x=this._def.y=0;break;case"circle":"number"==typeof this._def?this._def={cx:this._def,cy:this._def,r:this._def}:Array.isArray(this._def)?this._def={cx:this._def[0],cy:this._def[0],r:this._def[0]}:this._def.cx=this._def.cy=this._def.r;break;case"ellipse":"number"==typeof this._def?this._def={cx:this._def,cy:this._def,rx:this._def,ry:this._def}:Array.isArray(this._def)?this._def={cx:this._def[0],cy:this._def[1],rx:this._def[0],ry:this._def[1]}:(this._def.cx=this._def.rx,this._def.cy=this._def.ry);break;case"path":"string"==typeof this._def&&(this._def={d:this._def})}Object.getOwnPropertyNames(this._def).forEach(function(t){this.$el.setAttributeNS(null,t,this._def[t])},this),this.svgStyle?Object.getOwnPropertyNames(this.svgStyle).forEach(function(t){this.$el.setAttributeNS(null,t,this.svgStyle[t])},this):this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"),this.psv.cleanPosition(this),this.position3D=this.psv.sphericalCoordsToVector3(this)},PSVMarker.prototype._updatePolygon=function(){this._dynamicSize=!0,this.svgStyle?Object.getOwnPropertyNames(this.svgStyle).forEach(function(t){this.$el.setAttributeNS(null,t,this.svgStyle[t])},this):this.$el.setAttributeNS(null,"fill","rgba(0,0,0,0.5)"),[this.polygon_rad,this.polygon_px].forEach(function(t){if(t&&"object"!=typeof t[0])for(var e=0;e<t.length;e++)t.splice(e,2,[t[e],t[e+1]])}),this.polygon_px?this.polygon_rad=this.polygon_px.map(function(t){var e=this.psv.textureCoordsToSphericalCoords({x:t[0],y:t[1]});return[e.longitude,e.latitude]},this):this.polygon_rad=this.polygon_rad.map(function(t){return[PSVUtils.parseAngle(t[0]),PSVUtils.bound(PSVUtils.parseAngle(t[1],-Math.PI),-PSVUtils.HalfPI,PSVUtils.HalfPI)]}),this.longitude=this.polygon_rad[0][0],this.latitude=this.polygon_rad[0][1],this.positions3D=this.polygon_rad.map(function(t){return this.psv.sphericalCoordsToVector3({longitude:t[0],latitude:t[1]})},this)};var PSVUtils={};PhotoSphereViewer.Utils=PSVUtils,PSVUtils.TwoPI=2*Math.PI,PSVUtils.HalfPI=Math.PI/2,PSVUtils.svgNS="http://www.w3.org/2000/svg",PSVUtils.checkTHREE=function(t){for(var e=0,o=arguments.length;e<o;e++)if(!(arguments[e]in THREE))return!1;return!0},PSVUtils.isCanvasSupported=function(){var t=document.createElement("canvas");return!(!t.getContext||!t.getContext("2d"))},PSVUtils.getWebGLCtx=function(){var t=document.createElement("canvas"),e=["webgl","experimental-webgl","moz-webgl","webkit-3d"],o=null;return t.getContext&&e.some(function(e){try{return(o=t.getContext(e))&&"function"==typeof o.getParameter}catch(t){return!1}})?o:null},PSVUtils.isWebGLSupported=function(){return!!window.WebGLRenderingContext&&null!==PSVUtils.getWebGLCtx()},PSVUtils.getMaxTextureWidth=function(){var t=PSVUtils.getWebGLCtx();if(null!==t)return t.getParameter(t.MAX_TEXTURE_SIZE)},PSVUtils.toggleClass=function(t,e,o){if(t.classList)void 0===o?t.classList.toggle(e):o&&!t.classList.contains(e)?t.classList.add(e):o||t.classList.remove(e);else{var i=t.getAttribute("class")||"",r=-1!==i.indexOf(e),n=new RegExp("(?:^|\\s)"+e+"(?:\\s|$)");void 0!==o&&!o||r?o||(i=i.replace(n," ")):i+=i.length>0?" "+e:e,t.setAttribute("class",i)}},PSVUtils.addClasses=function(t,e){e&&e.split(" ").forEach(function(e){PSVUtils.toggleClass(t,e,!0)})},PSVUtils.removeClasses=function(t,e){e&&e.split(" ").forEach(function(e){PSVUtils.toggleClass(t,e,!1)})},PSVUtils.hasParent=function(t,e){do{if(t===e)return!0}while(t=t.parentNode);return!1},PSVUtils.getClosest=function(t,e){var o=t.matches||t.msMatchesSelector;do{if(o.bind(t)(e))return t}while(t=t.parentElement);return null},PSVUtils.mouseWheelEvent=function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},PSVUtils.fullscreenEvent=function(){var t={exitFullscreen:"fullscreenchange",webkitExitFullscreen:"webkitfullscreenchange",mozCancelFullScreen:"mozfullscreenchange",msExitFullscreen:"msFullscreenEnabled"};for(var e in t)if(e in document)return t[e]},PSVUtils.bound=function(t,e,o){return Math.max(e,Math.min(o,t))},PSVUtils.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},PSVUtils.sum=function(t){return t.reduce(function(t,e){return t+e},0)},PSVUtils.getXMPValue=function(t,e){var o;return null!==(o=t.match("<GPano:"+e+">(.*)</GPano:"+e+">"))?o[1]:null!==(o=t.match("GPano:"+e+'="(.*?)"'))?o[1]:null},PSVUtils.isFullscreenEnabled=function(t){return(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)===t},PSVUtils.requestFullscreen=function(t){(t.requestFullscreen||t.mozRequestFullScreen||t.webkitRequestFullscreen||t.msRequestFullscreen).call(t)},PSVUtils.exitFullscreen=function(){(document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen).call(document)},PSVUtils.getStyle=function(t,e){return window.getComputedStyle(t,null)[e]},PSVUtils.getShortestArc=function(t,e){return[0,PSVUtils.TwoPI,-PSVUtils.TwoPI].reduce(function(o,i){return i=e-t+i,Math.abs(i)<Math.abs(o)?i:o},1/0)},PSVUtils.parsePosition=function(t){if(!t)return{top:.5,left:.5};if("object"==typeof t)return t;var e=t.toLocaleLowerCase().split(" ").slice(0,2);1===e.length&&(e=void 0!==PSVUtils.parsePosition.positions[e[0]]?[e[0],"center"]:[e[0],e[0]]);var o="left"!=e[1]&&"right"!=e[1]&&"top"!=e[0]&&"bottom"!=e[0];e=e.map(function(t){return PSVUtils.parsePosition.positions[t]||t}),o||e.reverse();var i=e.join(" ").match(/^([0-9.]+)% ([0-9.]+)%$/);return i?{left:i[1]/100,top:i[2]/100}:{top:.5,left:.5}},PSVUtils.parsePosition.positions={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},PSVUtils.parseSpeed=function(t){if("string"==typeof t){t=t.toString().trim();var e=parseFloat(t.replace(/^(-?[0-9]+(?:\.[0-9]*)?).*$/,"$1")),o=t.replace(/^-?[0-9]+(?:\.[0-9]*)?(.*)$/,"$1").trim();switch(o.match(/(pm|per minute)$/)&&(e/=60),o){case"dpm":case"degrees per minute":case"dps":case"degrees per second":t=THREE.Math.degToRad(e);break;case"radians per minute":case"radians per second":t=e;break;case"rpm":case"revolutions per minute":case"rps":case"revolutions per second":t=e*PSVUtils.TwoPI;break;default:throw new PSVError('unknown speed unit "'+o+'"')}}return t},PSVUtils.parseAngle=function(t,e){if("string"==typeof t){var o=t.toLowerCase().trim().match(/^(-?[0-9]+(?:\.[0-9]*)?)(.*)$/);if(!o)throw new PSVError('unknown angle "'+t+'"');var i=parseFloat(o[1]),r=o[2];if(r)switch(r){case"deg":case"degs":t=THREE.Math.degToRad(i);break;case"rad":case"rads":t=i;break;default:throw new PSVError('unknown angle unit "'+r+'"')}}return!1!==e&&(void 0===e&&(e=0),(t=(t-e)%PSVUtils.TwoPI)<0&&(t=PSVUtils.TwoPI+t),t+=e),t},PSVUtils.cleanTHREEScene=function(t){t.children.forEach(function(t){t instanceof THREE.Mesh&&(t.geometry&&(t.geometry.dispose(),t.geometry=null),t.material&&(t.material.materials?(t.material.materials.forEach(function(t){t.map&&(t.map.dispose(),t.map=null),t.dispose()}),t.material.materials.length=0):(t.material.map&&(t.material.map.dispose(),t.material.map=null),t.material.dispose()),t.material=null))}),t.children.length=0},PSVUtils.animation=function(t){function e(r){if(-1!==o.promise.getStatus()){null===i&&(i=r);var n,s=(r-i)/t.duration,a={};if(s<1){for(n in t.properties)a[n]=t.properties[n].start+(t.properties[n].end-t.properties[n].start)*t.easing(s);t.onTick(a,s),window.requestAnimationFrame(e)}else{for(n in t.properties)a[n]=t.properties[n].end;t.onTick(a,1),window.requestAnimationFrame(function(){o.resolve()})}}}var o=D(!1),i=null;t.easing&&"string"!=typeof t.easing||(t.easing=PSVUtils.animation.easings[t.easing||"linear"]),void 0!==t.delay?window.setTimeout(function(){window.requestAnimationFrame(e)},t.delay):window.requestAnimationFrame(e);var r=o.promise;return r.cancel=function(){o.reject()},r},PSVUtils.animation.easings={linear:function(t){return t},inQuad:function(t){return t*t},outQuad:function(t){return t*(2-t)},inOutQuad:function(t){return t<.5?2*t*t:(4-2*t)*t-1},inCubic:function(t){return t*t*t},outCubic:function(t){return--t*t*t+1},inOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},inQuart:function(t){return t*t*t*t},outQuart:function(t){return 1- --t*t*t*t},inOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},inQuint:function(t){return t*t*t*t*t},outQuint:function(t){return 1+--t*t*t*t*t},inOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t},inSine:function(t){return 1-Math.cos(t*(Math.PI/2))},outSine:function(t){return Math.sin(t*(Math.PI/2))},inOutSine:function(t){return.5-.5*Math.cos(Math.PI*t)},inExpo:function(t){return Math.pow(2,10*(t-1))},outExpo:function(t){return 1-Math.pow(2,-10*t)},inOutExpo:function(t){return(t=2*t-1)<0?.5*Math.pow(2,10*t):1-.5*Math.pow(2,-10*t)},inCirc:function(t){return 1-Math.sqrt(1-t*t)},outCirc:function(t){return t--,Math.sqrt(1-t*t)},inOutCirc:function(t){return(t*=2)<1?.5-.5*Math.sqrt(1-t*t):.5+.5*Math.sqrt(1-(t-=2)*t)}},PSVUtils.throttle=function(t,e){var o,i,r,n=null,s=0,a=function(){s=Date.now(),n=null,r=t.apply(o,i),n||(o=i=null)};return function(){var h=Date.now();s||(s=h);var p=e-(h-s);return o=this,i=arguments,p<=0||p>e?(n&&(clearTimeout(n),n=null),s=h,r=t.apply(o,i),n||(o=i=null)):n||(n=setTimeout(a,p)),r}},PSVUtils.isPlainObject=function(t){if("object"==typeof t&&null!==t){if("function"==typeof Object.getPrototypeOf){var e=Object.getPrototypeOf(t);return e===Object.prototype||null===e}return"[object Object]"==Object.prototype.toString.call(t)}return!1},PSVUtils.deepmerge=function(t,e){var o=e;return function t(e,i){return Array.isArray(i)?(e&&Array.isArray(e)?e.length=0:e=[],i.forEach(function(o,i){e[i]=t(null,o)})):"object"==typeof i?(e&&!Array.isArray(e)||(e={}),Object.keys(i).forEach(function(r){"object"==typeof i[r]&&i[r]&&PSVUtils.isPlainObject(i[r])?i[r]!=o&&(e[r]?t(e[r],i[r]):e[r]=t(null,i[r])):e[r]=i[r]})):e=i,e}(t,e)},PSVUtils.clone=function(t){return PSVUtils.deepmerge(null,t)},function(t){"use strict";if(t.requestAnimationFrame=t.requestAnimationFrame||t.mozRequestAnimationFrame||t.webkitRequestAnimationFrame||t.msRequestAnimationFrame,t.cancelAnimationFrame=t.cancelAnimationFrame||t.mozCancelAnimationFrame||t.webkitCancelAnimationFrame||t.msCancelAnimationFrame,!t.requestAnimationFrame){var e,o=[],i=[],r=0;t.requestAnimationFrame=function(t){return o.push([++r,t]),e||(e=setInterval(function(){if(o.length){var t=+new Date,r=i;for(i=o,o=r;i.length;)i.shift()[1](t)}else clearInterval(e),e=void 0},20)),r},t.cancelAnimationFrame=function(t){var e,r;for(e=0,r=o.length;e<r;e+=1)if(o[e][0]===t)return void o.splice(e,1);for(e=0,r=i.length;e<r;e+=1)if(i[e][0]===t)return void i.splice(e,1)}}}(window),PhotoSphereViewer.ICONS["compass.svg"]='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M49.997,0C22.38,0.004,0.005,22.383,0,50.002C0.005,77.614,22.38,99.995,49.997,100C77.613,99.995,99.996,77.614,100,50.002C99.996,22.383,77.613,0.004,49.997,0z M49.997,88.81c-21.429-0.04-38.772-17.378-38.809-38.807c0.037-21.437,17.381-38.775,38.809-38.812C71.43,11.227,88.769,28.567,88.81,50.002C88.769,71.432,71.43,88.77,49.997,88.81z"/><path d="M72.073,25.891L40.25,41.071l-0.003-0.004l-0.003,0.009L27.925,74.109l31.82-15.182l0.004,0.004l0.002-0.007l-0.002-0.004L72.073,25.891z M57.837,54.411L44.912,42.579l21.092-10.062L57.837,54.411z"/>\x3c!--Created by iconoci from the Noun Project--\x3e</svg>',PhotoSphereViewer.ICONS["download.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><path d="M83.285,35.575H66.271L66.277,3H32.151v32.575H16.561l33.648,32.701L83.285,35.575z"/><path d="M83.316,64.199v16.32H16.592v-16.32H-0.094v32.639H100V64.199H83.316z"/>\x3c!--Created by Michael Zenaty from the Noun Project--\x3e</svg>',PhotoSphereViewer.ICONS["fullscreen-in.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><polygon points="100,39.925 87.105,39.925 87.105,18.895 66.075,18.895 66.075,6 100,6"/><polygon points="100,93.221 66.075,93.221 66.075,80.326 87.105,80.326 87.105,59.295 100,59.295"/><polygon points="33.925,93.221 0,93.221 0,59.295 12.895,59.295 12.895,80.326 33.925,80.326"/><polygon points="12.895,39.925 0,39.925 0,6 33.925,6 33.925,18.895 12.895,18.895"/>\x3c!--Created by Garrett Knoll from the Noun Project--\x3e</svg>',PhotoSphereViewer.ICONS["fullscreen-out.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 100 100" enable-background="new 0 0 100 100" xml:space="preserve"><polygon points="66.075,7 78.969,7 78.969,28.031 100,28.031 100,40.925 66.075,40.925"/><polygon points="66.075,60.295 100,60.295 100,73.19 78.969,73.19 78.969,94.221 66.075,94.221"/><polygon points="0,60.295 33.925,60.295 33.925,94.221 21.031,94.221 21.031,73.19 0,73.19"/><polygon points="21.031,7 33.925,7 33.925,40.925 0,40.925 0,28.031 21.031,28.031"/>\x3c!--Created by Garrett Knoll from the Noun Project--\x3e</svg>',PhotoSphereViewer.ICONS["pin.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 48 48" enable-background="new 0 0 48 48" xml:space="preserve"><path d="M24,0C13.798,0,5.499,8.3,5.499,18.501c0,10.065,17.57,28.635,18.318,29.421C23.865,47.972,23.931,48,24,48s0.135-0.028,0.183-0.078c0.748-0.786,18.318-19.355,18.318-29.421C42.501,8.3,34.202,0,24,0z M24,7.139c5.703,0,10.342,4.64,10.342,10.343c0,5.702-4.639,10.342-10.342,10.342c-5.702,0-10.34-4.64-10.34-10.342C13.66,11.778,18.298,7.139,24,7.139z"/>\x3c!--Created by Daniele Marucci from the Noun Project--\x3e</svg>',PhotoSphereViewer.ICONS["play-active.svg"]='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 41 41" enable-background="new 0 0 41 41" xml:space="preserve"><path d="M40.5,14.1c-0.1-0.1-1.2-0.5-2.898-1C37.5,13.1,37.4,13,37.4,12.9C34.5,6.5,28,2,20.5,2S6.6,6.5,3.7,12.9c0,0.1-0.1,0.1-0.2,0.2c-1.7,0.6-2.8,1-2.9,1L0,14.4v12.1l0.6,0.2c0.1,0,1.1,0.399,2.7,0.899c0.1,0,0.2,0.101,0.2,0.199C6.3,34.4,12.9,39,20.5,39c7.602,0,14.102-4.6,16.9-11.1c0-0.102,0.1-0.102,0.199-0.2c1.699-0.601,2.699-1,2.801-1l0.6-0.3V14.3L40.5,14.1z M6.701,11.5C9.7,7,14.8,4,20.5,4c5.8,0,10.9,3,13.8,7.5c0.2,0.3-0.1,0.6-0.399,0.5c-3.799-1-8.799-2-13.6-2c-4.7,0-9.5,1-13.2,2C6.801,12.1,6.601,11.8,6.701,11.5z M25.1,20.3L18.7,24c-0.3,0.2-0.7,0-0.7-0.5v-7.4c0-0.4,0.4-0.6,0.7-0.4 l6.399,3.8C25.4,19.6,25.4,20.1,25.1,20.3z M34.5,29.201C31.602,33.9,26.4,37,20.5,37c-5.9,0-11.1-3.1-14-7.898c-0.2-0.302,0.1-0.602,0.4-0.5c3.9,1,8.9,2.1,13.6,2.1c5,0,9.9-1,13.602-2C34.4,28.602,34.602,28.9,34.5,29.201z"/>\x3c!--Created by Nick Bluth from the Noun Project--\x3e</svg>',PhotoSphereViewer.ICONS["play.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 41 41" enable-background="new 0 0 41 41" xml:space="preserve"><path d="M40.5,14.1c-0.1-0.1-1.2-0.5-2.899-1c-0.101,0-0.2-0.1-0.2-0.2C34.5,6.5,28,2,20.5,2S6.6,6.5,3.7,12.9c0,0.1-0.1,0.1-0.2,0.2c-1.7,0.6-2.8,1-2.9,1L0,14.4v12.1l0.6,0.2c0.1,0,1.1,0.4,2.7,0.9c0.1,0,0.2,0.1,0.2,0.199C6.3,34.4,12.9,39,20.5,39c7.601,0,14.101-4.6,16.9-11.1c0-0.101,0.1-0.101,0.2-0.2c1.699-0.6,2.699-1,2.8-1l0.6-0.3V14.3L40.5,14.1zM20.5,4c5.8,0,10.9,3,13.8,7.5c0.2,0.3-0.1,0.6-0.399,0.5c-3.8-1-8.8-2-13.6-2c-4.7,0-9.5,1-13.2,2c-0.3,0.1-0.5-0.2-0.4-0.5C9.7,7,14.8,4,20.5,4z M20.5,37c-5.9,0-11.1-3.1-14-7.899c-0.2-0.301,0.1-0.601,0.4-0.5c3.9,1,8.9,2.1,13.6,2.1c5,0,9.9-1,13.601-2c0.3-0.1,0.5,0.2,0.399,0.5C31.601,33.9,26.4,37,20.5,37z M39.101,24.9c0,0.1-0.101,0.3-0.2,0.3c-2.5,0.9-10.4,3.6-18.4,3.6c-7.1,0-15.6-2.699-18.3-3.6C2.1,25.2,2,25,2,24.9V16c0-0.1,0.1-0.3,0.2-0.3c2.6-0.9,10.6-3.6,18.2-3.6c7.5,0,15.899,2.7,18.5,3.6c0.1,0,0.2,0.2,0.2,0.3V24.9z"/><path d="M18.7,24l6.4-3.7c0.3-0.2,0.3-0.7,0-0.8l-6.4-3.8c-0.3-0.2-0.7,0-0.7,0.4v7.4C18,24,18.4,24.2,18.7,24z"/>\x3c!--Created by Nick Bluth from the Noun Project--\x3e</svg>',PhotoSphereViewer.ICONS["zoom-in.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M14.043,12.22c2.476-3.483,1.659-8.313-1.823-10.789C8.736-1.044,3.907-0.228,1.431,3.255c-2.475,3.482-1.66,8.312,1.824,10.787c2.684,1.908,6.281,1.908,8.965,0l4.985,4.985c0.503,0.504,1.32,0.504,1.822,0c0.505-0.503,0.505-1.319,0-1.822L14.043,12.22z M7.738,13.263c-3.053,0-5.527-2.475-5.527-5.525c0-3.053,2.475-5.527,5.527-5.527c3.05,0,5.524,2.474,5.524,5.527C13.262,10.789,10.788,13.263,7.738,13.263z"/><polygon points="8.728,4.009 6.744,4.009 6.744,6.746 4.006,6.746 4.006,8.73 6.744,8.73 6.744,11.466 8.728,11.466 8.728,8.73 11.465,8.73 11.465,6.746 8.728,6.746"/>\x3c!--Created by Ryan Canning from the Noun Project--\x3e</svg>',PhotoSphereViewer.ICONS["zoom-out.svg"]='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve"><path d="M14.043,12.22c2.476-3.483,1.659-8.313-1.823-10.789C8.736-1.044,3.907-0.228,1.431,3.255c-2.475,3.482-1.66,8.312,1.824,10.787c2.684,1.908,6.281,1.908,8.965,0l4.985,4.985c0.503,0.504,1.32,0.504,1.822,0c0.505-0.503,0.505-1.319,0-1.822L14.043,12.22z M7.738,13.263c-3.053,0-5.527-2.475-5.527-5.525c0-3.053,2.475-5.527,5.527-5.527c3.05,0,5.524,2.474,5.524,5.527C13.262,10.789,10.788,13.263,7.738,13.263z"/><rect x="4.006" y="6.746" width="7.459" height="1.984"/>\x3c!--Created by Ryan Canning from the Noun Project--\x3e</svg>';